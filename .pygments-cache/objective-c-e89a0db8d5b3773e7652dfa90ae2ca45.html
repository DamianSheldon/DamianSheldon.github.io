<div class="highlight"><pre><span class="k">@implementation</span> <span class="nc">ViewController</span>
<span class="p">{</span>
   <span class="n">TagCollectionViewCell</span> <span class="o">*</span><span class="n">_sizingCell</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
<span class="p">{</span>
   <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
 
   <span class="bp">UINib</span> <span class="o">*</span><span class="n">cellNib</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UINib</span> <span class="nl">nibWithNibName</span><span class="p">:</span><span class="s">@&quot;TagCollectionViewCell&quot;</span> <span class="nl">bundle</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
   <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nl">registerNib</span><span class="p">:</span><span class="n">cellNib</span> <span class="nl">forCellWithReuseIdentifier</span><span class="p">:</span><span class="s">@&quot;TagCell&quot;</span><span class="p">];</span>
 
   <span class="c1">// get a cell as template for sizing</span>
   <span class="n">_sizingCell</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cellNib</span> <span class="nl">instantiateWithOwner</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">options</span><span class="p">:</span><span class="nb">nil</span><span class="p">]</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>
 
<span class="cp">#pragma mark - UICollectionView</span>
 
<span class="p">-</span> <span class="p">(</span><span class="bp">NSInteger</span><span class="p">)</span><span class="nf">collectionView:</span><span class="p">(</span><span class="bp">UICollectionView</span> <span class="o">*</span><span class="p">)</span><span class="nv">collectionView</span> <span class="nf">numberOfItemsInSection:</span><span class="p">(</span><span class="bp">NSInteger</span><span class="p">)</span><span class="nv">section</span>
<span class="p">{</span>
   <span class="k">return</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">_configureCell:</span><span class="p">(</span><span class="n">TagCollectionViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nv">cell</span> <span class="nf">forIndexPath:</span><span class="p">(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
<span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="n">cell</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;A&quot;</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="o">%</span><span class="mi">3</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="n">cell</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;longer&quot;</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">else</span> 
   <span class="p">{</span>
      <span class="n">cell</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;much longer&quot;</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
 
<span class="p">-</span> <span class="p">(</span><span class="bp">UICollectionViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">collectionView:</span><span class="p">(</span><span class="bp">UICollectionView</span> <span class="o">*</span><span class="p">)</span><span class="nv">collectionView</span> <span class="nf">cellForItemAtIndexPath:</span><span class="p">(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
<span class="p">{</span>
   <span class="n">TagCollectionViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">collectionView</span> <span class="nl">dequeueReusableCellWithReuseIdentifier</span><span class="p">:</span><span class="s">@&quot;TagCell&quot;</span> <span class="nl">forIndexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
 
   <span class="p">[</span><span class="nb">self</span> <span class="nl">_configureCell</span><span class="p">:</span><span class="n">cell</span> <span class="nl">forIndexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
 
   <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="p">-</span> <span class="p">(</span><span class="bp">CGSize</span><span class="p">)</span><span class="nf">collectionView:</span><span class="p">(</span><span class="bp">UICollectionView</span> <span class="o">*</span><span class="p">)</span><span class="nv">collectionView</span> <span class="nf">layout:</span><span class="p">(</span><span class="bp">UICollectionViewLayout</span><span class="o">*</span><span class="p">)</span><span class="nv">collectionViewLayout</span> <span class="nf">sizeForItemAtIndexPath:</span><span class="p">(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span>
<span class="p">{</span>
   <span class="p">[</span><span class="nb">self</span> <span class="nl">_configureCell</span><span class="p">:</span><span class="n">_sizingCell</span> <span class="nl">forIndexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
 
   <span class="k">return</span> <span class="p">[</span><span class="n">_sizingCell</span> <span class="n">intrinsicContentSize</span><span class="p">];</span>
<span class="p">}</span>
 
<span class="k">@end</span>
</pre></div>