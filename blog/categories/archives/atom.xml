<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: archives | Hello World]]></title>
  <link href="http://DamianSheldon.github.io/blog/categories/archives/atom.xml" rel="self"/>
  <link href="http://DamianSheldon.github.io/"/>
  <updated>2016-02-25T09:19:07+08:00</updated>
  <id>http://DamianSheldon.github.io/</id>
  <author>
    <name><![CDATA[Sheldon]]></name>
    <email><![CDATA[dongmeilianghy@sina.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Notes Of Using OpenCart]]></title>
    <link href="http://DamianSheldon.github.io/blog/notes-of-using-opencart.html"/>
    <updated>2016-02-21T17:50:35+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/notes-of-using-opencart</id>
    <content type="html"><![CDATA[<h3>1. opencart 安装中文语言包</h3>

<p>A:</p>

<ul>
<li>[下载中文语言包](<a href="http://www.opencart.cn/thread-9982-1-1.html%EF%BC%89">http://www.opencart.cn/thread-9982-1-1.html%EF%BC%89</a></li>
<li>解压压缩包，里面有两个文件夹，admin是后台语言包，catalog文件是前台语言包</li>
<li>把文件上传到对应的目录下</li>
</ul>


<pre><code>$ cd ~/Downloads/
$ tar -xzvf OpenCart_SimplifiedChinese_language_v2.0.3.1.zip
$ cp -R OpenCart_SimplifiedChinese_language_v2.0.3.1/upload/catalog/language/zh-CN  ~/Sites/upload/catalog/language/
$ cp -R OpenCart_SimplifiedChinese_language_v2.0.3.1/upload/admin/language/zh-CN ~/Sites/upload/admin/language/
</code></pre>

<ul>
<li>System > Localisation > languages > + > Chinese(Language Name) > Code(select zh-CN) > Save</li>
<li>System > Settings > Your Store > Edit > Local > Language (Chinese) > Administration Language (Chinese) > Save</li>
</ul>


<h3>2. opencart如何增加人民币？</h3>

<p>A:</p>

<ul>
<li><p>系统设置 > 参数设置 > 货币设置 > +</p>

<ul>
<li>货币名称 人民币</li>
<li>货币代码 CNY</li>
<li>左符号 ¥</li>
<li>右符号</li>
<li>小数位 2</li>
<li>汇率 1.00000</li>
<li>状态 启用</li>
</ul>
</li>
<li><p>系统设置 > 网店设置 > 选择你的网店 > 编辑 > 本地化设置 > 货币设置 > 人民币 > 保存</p></li>
</ul>


<p>Reference:<a href="http://www.opencart-extension.com/opencart-add-renminbi.html">http://www.opencart-extension.com/opencart-add-renminbi.html</a></p>

<h3>3. 如何添加推荐商品？</h3>

<p>A: 扩展功能 > 模块配置 > 推荐商品 > Home Page > Product Name</p>

<h3>4. 如何设置幻灯片？</h3>

<p>A: 设计 > 横幅 > Home Page Slideshow > Edit</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS Unit Testing With OCMock]]></title>
    <link href="http://DamianSheldon.github.io/blog/ios-unit-testing-with-ocmock.html"/>
    <updated>2016-01-22T14:19:12+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/ios-unit-testing-with-ocmock</id>
    <content type="html"><![CDATA[<p>单元测试是我们保障代码质量的重要手段， Apple 对此也十分重视，这点可以从 Xcode 新建工程时会自动创建单元测试的 Target 看出来。单元测试牵涉的内容很多，这篇文章是目前我对单元测试的理解。</p>

<p>既然是单元测试，那么什么是单元呢？我没有去考证，但我是这么理解的：面向对象编程范式里一切皆对象，而对象是由实例变量和方法组成，对象之间通过方法互相作用，我们的应用可以看作是一个对象图，对象图上的对象相互作用来实现我们的需求。这么看来我们的单元应该是对象的方法。</p>

<p>对象的方法在工作的时候可能要依赖其他对象，为了去除依赖对象对测试的影响，我们引入 Mock.</p>

<blockquote><p>Mocks are ‘fake’ objects with pre-defined behavior to stand-in for concrete objects during testing. &ndash; HackaZach</p></blockquote>

<p>引用 Mock 之后，我们在单元测试中如何使用它呢？</p>

<blockquote><p>The general recipe for using mocks in unit-tests is:</p>

<ol>
<li>Create the mock object</li>
<li>Specify the expected invocations and return values</li>
<li>Associate the mock object with the code under test</li>
<li>Execute the code under test</li>
<li>Validate that your assertions are correct</li>
</ol>
</blockquote>

<!-- more -->


<h3>Create the mock object</h3>

<p>OCMock 中创建 Mock 对象的方法如下：</p>

<table>
<thead>
<tr>
<th> Factory Method </th>
<th> Description </th>
</tr>
</thead>
<tbody>
<tr>
<td> +mockForClass: </td>
<td> Create a mock based on the given class </td>
</tr>
<tr>
<td> +mockForProtocol: </td>
<td> Create a mock based on the given protocol </td>
</tr>
<tr>
<td> +niceMockForClass: </td>
<td> Create a &ldquo;nice&rdquo; mock based on the given class </td>
</tr>
<tr>
<td> +niceMockForProtocol: </td>
<td> Create a &ldquo;nice&rdquo; mock based on the given protocol </td>
</tr>
<tr>
<td> +partialMockForObject: </td>
<td> Create a mock based on the given object </td>
</tr>
<tr>
<td> +observerMock: </td>
<td> Create a notification observer (more on this later) </td>
</tr>
</tbody>
</table>


<p>Mock 对象是只是一个空壳，只能调用预先定义的方法，调用没有预先定义的方法会抛出异常；
Nice Mock 对象也是一个空壳，只是它会忽略没有预先定义的方法不会抛出异常；
Partial Mock 对象是把一个已有的对象转成 Mock，调用没有预先定义的方法，它会把方法传给已存在的对象；<br/>
Observer Mock 对象是用来观察通知的。</p>

<h3>Specify the expected invocations and return values</h3>

<blockquote><p>Calling either the -expect or -stub method will return an object that you can use to setup your expectations.</p></blockquote>

<ul>
<li><p>Specify the expected invocations</p>

<ol>
<li>不带参数的方法</li>
</ol>
</li>
</ul>


<pre><code>
- (void)testInit {
  id mockService = [OCMockObject mockForProtocol:@protocol(AVQuoteService)];
  [[mockService expect] initiateConnection];

  AVStockPortfolio *portfolio = [[AVStockPortfolio alloc] initWithService:mockService];

  [mockService verify];
}
</code></pre>

<p></br>
    2. 带参数的方法</p>

<blockquote><p>You can use any of the following OCMArg class methods in place of a real argument when setting up your method expectations:</p></blockquote>

<table>
<thead>
<tr>
<th> OCMArg method </th>
<th> Description </th>
</tr>
</thead>
<tbody>
<tr>
<td> +any </td>
<td> Any argument is accepted. </td>
</tr>
<tr>
<td> +anyPointer </td>
<td> Accepts any pointer </td>
</tr>
<tr>
<td> +isNil     </td>
<td> The given argument must be nil </td>
</tr>
<tr>
<td> +isNotNil  </td>
<td> The given argument must not be nil </td>
</tr>
<tr>
<td> +isNotEqual:   </td>
<td> Given argument is not object-equivalent with expectation </td>
</tr>
<tr>
<td> +checkWithSelector: </td>
<td> onObject:   Check the argument with the given action/target pair </td>
</tr>
<tr>
<td> +checkWithBlock: </td>
<td> Check the argument with the given block (OS X 10.6 or iOS 4) </td>
</tr>
</tbody>
</table>


<blockquote><p>OCMock also provides a few handy macros for argument matching:</p></blockquote>

<table>
<thead>
<tr>
<th> Macro </th>
<th> Description </th>
</tr>
</thead>
<tbody>
<tr>
<td> OCMOCK_ANY()   </td>
<td> Equivalent to [OCMArg any] </td>
</tr>
<tr>
<td> OCMOCK_VALUE(value) </td>
<td> A quick way to match a non-object argument </td>
</tr>
<tr>
<td> CONSTRAINT(selector) </td>
<td> Validate with a given selector on self </td>
</tr>
<tr>
<td> CONSTRAINTV(selector,value) </td>
<td>     Validate with a given selector on self and an additional argument </td>
</tr>
</tbody>
</table>


<pre><code>id classMock = OCMClassMock([SomeClass class]);
OCMExpect([classMock someMethodWithArgument:[OCMArg isNotNil]]);

/* run code under test, which is assumed to call someMethod */

OCMVerifyAll(classMock)
</code></pre>

<p></br>
    3. 通知</p>

<pre><code>- (void)testSellSharesInStock {
  id mock = [OCMockObject observerMock];
  // OCMock adds a custom methods to NSNotificationCenter via a category
  [[NSNotificationCenter defaultCenter] addMockObserver:mock
                                                   name:AVStockSoldNotification
                                                 object:nil];

  [[mock expect] notificationWithName:AVStockSoldNotification object:[OCMArg any]];

  AVPortfolio *portfolio = [self createPortfolio]; // made-up factory method
  [portfolio sellShares:100 inStock:@"AAPL"];

  [mock verify];
}
</code></pre>

<ul>
<li>Specify the return values</li>
</ul>


<blockquote><p>If methods on your mocks need to return values, you have a variety of methods to call on the object returned by -expect or -stub.</p></blockquote>

<table>
<thead>
<tr>
<th> Method </th>
<th> Explanation </th>
</tr>
</thead>
<tbody>
<tr>
<td> -andReturn: </td>
<td> Return the given object </td>
</tr>
<tr>
<td> -andReturnValue: </td>
<td> Return a non-object value (wrapped in a NSValue) </td>
</tr>
<tr>
<td> -andThrow: </td>
<td> Throw the given exception </td>
</tr>
<tr>
<td> -andPost: </td>
<td>   Post the given notification </td>
</tr>
<tr>
<td> -andCall:onObject: </td>
<td> Call the selector on the given object </td>
</tr>
<tr>
<td> -andDo: </td>
<td> Invoke the given block (only on OS X 10.6 or iOS 4) </td>
</tr>
</tbody>
</table>


<h3>Execution &amp; Validation</h3>

<ul>
<li>Associate the mock object with the code under test</li>
<li>Execute the code under test</li>
<li>Validate that your assertions are correct</li>
</ul>


<pre><code>- (void)testSellSharesInStock {
  id quoteService = [[OCMockObject] mockForProtocol:@protocol(AVQuoteService)];
  [[[quoteService expect] andDo:^(NSInvocation *invocation) {
    // validate arguments, set return value on the invocation object
  }] priceForStock:@"AAPL"];

  // Associate the mock object with the code under test
  AVStockPortfolio *portfolio = [[AVStockPortfolio alloc] initWithService:quoteService];
  // Execute the code under test
  [portfolio sellShares:100 inStock:@"AAPL"];

  // Validate that your assertions are correct

  [quoteService verify];
}
</code></pre>

<p>Q:How to mocking singleton?
A:</p>

<pre><code>// we can replace it with a mock object
id mockManager = [OCMockObject mockForClass:[ArticleManager class]];
[ArticleManager setSharedInstance:mockManager];
// we can reset it so that it returns the actual ArticleManager
[ArticleManager setSharedInstance:nil];

// Objective-C Singleton Pattern Updated For Testability
@implementation ArticleManager

static ArticleManager *_sharedInstance = nil;
static dispatch_once_t once_token = 0;

+(instancetype)sharedInstance {
    dispatch_once(&amp;once_token, ^{
        if (_sharedInstance == nil) {
            _sharedInstance = [[ArticleManager alloc] init];
        }
    });
    return _sharedInstance;
}

+(void)setSharedInstance:(ArticleManager *)instance {
    once_token = 0; // resets the once_token so dispatch_once will run again
    _sharedInstance = instance;
}

@end
</code></pre>

<p>Reference:<a href="http://twobitlabs.com/2013/01/objective-c-singleton-pattern-unit-testing/">Objective-C Singleton Pattern Updated For Testability</a></p>

<h2>Reference:</h2>

<p><a href="http://ocmock.org">OCMock</a><br/>
<a href="http://www.archive.alexvollmer.com/posts/2010/06/28/making-fun-of-things-with-ocmock/">Making Fun of Things with OCMock</a><br/>
<a href="http://hackazach.net/code/2014/03/03/effective-testing-with-ocmock/">OCMock Test Origami</a><br/>
<a href="http://engineering.aweber.com/improving-ios-unit-tests-with-ocmock/">IMPROVING IOS UNIT TESTS WITH OCMOCK</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS App 开发问题汇总（五）]]></title>
    <link href="http://DamianSheldon.github.io/blog/ios-development-problems-part-5.html"/>
    <updated>2016-01-08T21:32:22+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/ios-development-problems-part-5</id>
    <content type="html"><![CDATA[<h3>1.On iOS 7 and later, how do I take a snapshot of my view and save the result in a UIImage?</h3>

<p>Solution:</p>

<pre><code>- (UIImage *)snapshot:(UIView *)view
{
    UIGraphicsBeginImageContextWithOptions(view.bounds.size, YES, 0);
    [view drawViewHierarchyInRect:view.bounds afterScreenUpdates:YES];
    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    return image;
}
</code></pre>

<p>Reference:<a href="https://developer.apple.com/library/ios/qa/qa1817/_index.html">https://developer.apple.com/library/ios/qa/qa1817/_index.html</a></p>

<h3>2.How to present a view controller on iOS7 without the status bar overlapping?</h3>

<p>Solution:The easiest workaround I&rsquo;ve found is to wrap the view controller you want to present inside a navigation controller, and then present that navigation controller.</p>

<pre><code>MyViewController *vc = [MyViewController new];
UINavigationController *nvc = [[UINavigationController alloc] 
    initWithRootViewController:vc];
[self presentViewController:nvc animated:YES completion:nil];
</code></pre>

<h3>3.代码创建 UITableView 时如何使用各种系统样式的 UITableViewCell?</h3>

<p>Solution:</p>

<pre><code>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    static NSString *sCellID = @"CellID";

    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:sCellID];
    if (!cell) {
        cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:sCellID];
    }
    // Configure the cell...

    return cell;
}
</code></pre>

<!-- more -->


<h3>4.Settings bundle not showing up in iPhone settings</h3>

<p>Solution:iOS 9.0.x - 9.2 Settings App Bug, Using the App Switch UI (double-press Home button) to kill the Settings App.</p>

<p>Reference:<a href="http://stackoverflow.com/questions/2683793/settings-bundle-not-showing-up-in-iphone-settings">http://stackoverflow.com/questions/2683793/settings-bundle-not-showing-up-in-iphone-settings</a></p>

<h3>5.单元测试的 Target 在测试导航栏里是灰色的不能点击测试。</h3>

<p>Solution: Edit Scheme &hellip; > Test > + > Select your test target.</p>

<h3>6.How to change UITableViewCell Image to Circle in UITableView</h3>

<p>Solution:</p>

<pre><code>// Subclass UITableViewCell override layoutSubviews method

- (void)layoutSubviews
{
    [super layoutSubviews];

    self.imageView.layer.cornerRadius = CGRectGetHeight(self.imageView.frame) * 0.5;
    self.imageView.layer.masksToBounds = YES;
}
</code></pre>

<p>Reference:<a href="http://stackoverflow.com/questions/23350728/how-to-change-uitableviewcell-image-to-circle-in-uitableview">http://stackoverflow.com/questions/23350728/how-to-change-uitableviewcell-image-to-circle-in-uitableview</a></p>

<h3>7.How to downgrading Cocoapods?</h3>

<p>A:</p>

<pre><code>// First you can figure out which version of Cocoapods you are on with the command:
$ pod --version

// You can also see all the version of Cocoapods you have installed with this command:
$ sudo gem list cocoapods

// Next uninstall Cocoapods. If you have multiple version, you will have the choice of uninstalling all or a specific version.
$ sudo gem uninstall cocoapods

// Finally you can install the specific version with this command:
$ sudo gem install cocoapods -v 0.39.0
</code></pre>

<p>Reference:<a href="https://diego.org/2015/09/24/downgrading-cocoapods/">https://diego.org/2015/09/24/downgrading-cocoapods/</a></p>

<h3>8.How to get UISearchDisplayController to search only after search button is pressed？</h3>

<p>A:Setup a delegate for the search bar and implement the searchBarSearchButtonClicked: method. Do your searching from that method. Just return NO from the shouldReloadTableForSearchString method.</p>

<p>Reference:<a href="http://stackoverflow.com/questions/18563529/how-to-get-uisearchdisplaycontroller-to-search-only-after-search-button-is-press">http://stackoverflow.com/questions/18563529/how-to-get-uisearchdisplaycontroller-to-search-only-after-search-button-is-press</a></p>

<h3>9.Warning: the running version of Bundler is older than the version that created the lockfile. We suggest you upgrade to the latest version of Bundler by running <code>gem install bundler</code>.</h3>

<p>A:</p>

<pre><code>$ sudo gem install bundler
$ bundle install

...
An error occurred while installing git (1.2.9.1), and Bundler cannot continue.
Make sure that `gem install git -v '1.2.9.1'` succeeds before bundling.

$ sudo gem install git -v '1.2.9.1'
$ sudo gem install lowdown -v '0.0.5' --verbose
...
ERROR:  Error installing lowdown:
    lowdown requires Ruby version &gt;= 2.1.0.

$ ruby --version
ruby 2.0.0p645 (2015-04-13 revision 50299) [universal.x86_64-darwin15]
// On OS X machines, you can use third-party tools (rbenv and RVM).
// Install RVM:
$ \curl -sSL https://get.rvm.io | bash -s stable --ruby=2.1.8

* To start using RVM you need to run `source /Users/dongmeiliang/.rvm/scripts/rvm`
    in all your open shell windows, in rare cases you need to reopen all shell windows.
$ source /Users/dongmeiliang/.rvm/scripts/rvm

// Check rvm has been installed successfully
$ rvm --help

$ bundle install
/System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/rubygems/dependency.rb:296:in `to_specs': Could not find 'bundler' (&gt;= 0) among 13 total gem(s) (Gem::LoadError)
    from /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/rubygems/dependency.rb:307:in `to_spec'
    from /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/rubygems/core_ext/kernel_gem.rb:47:in `gem'
    from /usr/local/bin/bundle:22:in `&lt;main&gt;'

We need reinstall bundler after update ruby:
$ gem install bundler
Fetching: bundler-1.11.2.gem (100%)
Successfully installed bundler-1.11.2
Parsing documentation for bundler-1.11.2
Installing ri documentation for bundler-1.11.2
Done installing documentation for bundler after 6 seconds
1 gem installed

//bundle - Ruby Dependency Management
//gem -- RubyGems program, RubyGems is a sophisticated package manager for Ruby.
//rvm - The Ruby Version Manager
</code></pre>

<h3>10.Attempt to set a non-property-list object</h3>

<pre><code>Attempt to set a non-property-list object &lt;CFBasicHash 0x15809b8d0 [0x19ec23b68]&gt;{type = immutable dict, count = 12,

entries =&gt;

    0 : id = &lt;CFNumber 0xb000000000000043 [0x19ec23b68]&gt;{value = +4, type = kCFNumberSInt64Type}

    1 : &lt;CFString 0x156dda8d0 [0x19ec23b68]&gt;{contents = "allFreeLifeId"} = &lt;CFNull 0x19ec23ea8 [0x19ec23b68]&gt;

    5 : &lt;CFString 0x156fd04d0 [0x19ec23b68]&gt;{contents = "portraitUri"} = &lt;CFNull 0x19ec23ea8 [0x19ec23b68]&gt;

    6 : mobile = &lt;CFString 0x156df0dd0 [0x19ec23b68]&gt;{contents = "18670789602"}

    11 : ryUserId = &lt;CFString 0x156fbef80 [0x19ec23b68]&gt;{contents = "AFL2016020310001627518670789602"}

    13 : birthDay = &lt;CFNull 0x19ec23ea8 [0x19ec23b68]&gt;

    14 : signature = &lt;CFString 0x19a51d480 [0x19ec23b68]&gt;{contents = ""}

    15 : token = &lt;CFString 0x1580a3cc0 [0x19ec23b68]&gt;{contents = "vL9oen0gHgJF7sRMWdaacY9LZ0Y0py8pcDvpcwTzcsCvfbB0kFB1PaDbWZ1c1GGZ8/jRvJ5KfX2oT3Sv+7Wb75r8W7FhoewF9l1Si6GJa2B48Xpc3rElo2a6FVG/X29zQOiOTHRjfiM="}

    16 : password = &lt;CFString 0x1580d5050 [0x19ec23b68]&gt;{contents = "E10ADC3949BA59ABBE56E057F20F883E"}

    20 : email = &lt;CFNull 0x19ec23ea8 [0x19ec23b68]&gt;

    21 : name = Julian

    22 : gender = &lt;CFNull 0x19ec23ea8 [0x19ec23b68]&gt;

}

 as an NSUserDefaults/CFPreferences value for key UserInfo
</code></pre>

<p>A:</p>

<pre><code>// Write
NSData *dataFromUserInfo = [NSKeyedArchiver archivedDataWithRootObject:userInfo];
[[NSUserDefaults standardUserDefaults] setObject:dataFromUserInfo forKey:sUserInfoKey];

// Read
NSData *dataFromUserInfo = [[NSUserDefaults standardUserDefaults] objectForKey:sUserInfoKey];
NSDictionary *ret = [NSKeyedUnarchiver unarchiveObjectWithData:dataFromUserInfo];
</code></pre>

<p>Reference:<a href="http://stackoverflow.com/questions/19720611/attempt-to-set-a-non-property-list-object-as-an-nsuserdefaults">http://stackoverflow.com/questions/19720611/attempt-to-set-a-non-property-list-object-as-an-nsuserdefaults</a></p>

<h3>11.Missing iOS Distribution signing identity</h3>

<p>A:KeyChain Access > select the System keychain > View > Show Expired Certificates > delete the expired version of the Apple Worldwide Developer Relations Certificate Authority Intermediate certificate (expired on February 14, 2016)</p>

<p>Reference:<a href="http://stackoverflow.com/questions/32821189/xcode-7-error-missing-ios-distribution-signing-identity-for">http://stackoverflow.com/questions/32821189/xcode-7-error-missing-ios-distribution-signing-identity-for</a></p>

<h3>12. FMDB unable to open db under Application Support directory.</h3>

<p>A:Unlike the Documents directory, the Application Support directory does not exist in the app&rsquo;s sandbox by default. You need to create it before you can use it.</p>

<pre><code>NSURL * ApplicationSupportDirectory()
{
    NSURL *applicationSupportDir = URLOfDirectory(NSApplicationSupportDirectory);

    if (applicationSupportDir) {
        // If the directory does not exist, this method creates it.
        // This method is only available in OS X v10.7 and iOS 5.0 or later.
        [[NSFileManager defaultManager] createDirectoryAtURL:applicationSupportDir withIntermediateDirectories:YES attributes:nil error:nil];
    }

    return applicationSupportDir;
}
</code></pre>

<p>Reference:<a href="http://stackoverflow.com/questions/16204988/ios-cant-save-file-to-application-support-folder-but-can-to-documents">http://stackoverflow.com/questions/16204988/ios-cant-save-file-to-application-support-folder-but-can-to-documents</a>
<a href="http://www.cocoawithlove.com/2010/05/finding-or-creating-application-support.html">http://www.cocoawithlove.com/2010/05/finding-or-creating-application-support.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[用 Wireshark 抓 iPhone 网络请求的数据包]]></title>
    <link href="http://DamianSheldon.github.io/blog/capturing-iphone-traffic-on-wireshark.html"/>
    <updated>2016-01-04T14:43:00+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/capturing-iphone-traffic-on-wireshark</id>
    <content type="html"><![CDATA[<p>开发过程中经常可能遇到网络问题，这时候我们需要抓包来定位问题所在。那么如何用 Wireshark 抓取 iPhone 真机网络请求的数据包呢？</p>

<blockquote><p>iOS does not support packet tracing directly. However, if you&rsquo;re developing for iOS you can take a packet trace of your app in a number of different ways:</p>

<p>If the problem you&rsquo;re trying to debug occurs on Wi-Fi, you can put your iOS device on a test Wi-Fi network. See Wi-Fi Capture for details.<br/>
If your app uses HTTP, you can configure your iOS device to use a debugging HTTP proxy (such as Charles HTTP Proxy).<br/>
In iOS 5 and later you can use the remote virtual interface facility.</p></blockquote>

<!-- more -->


<p>这里我使用的是第三种方法：remote virtual interface。</p>

<p>iOS 5 added a remote virtual interface (RVI) facility that lets you use OS X packet trace programs to capture traces from an iOS device. The basic strategy is:</p>

<ol>
<li>Connect your iOS device to your Mac via USB.</li>
<li>Set up an RVI for that device. This creates a virtual network interface on your Mac that represents the iOS device&rsquo;s networking stack.</li>
<li>Run your OS X packet trace program, and point it at the RVI created in the previous step.</li>
</ol>


<pre><code>$ # First get the current list of interfaces.
$ ifconfig -l
lo0 gif0 stf0 en0 en1 p2p0 fw0 ppp0 utun0
$ # Get connected device's UDID follow: Xcode &gt; Window &gt; Devices &gt; Select connected device &gt; identifier
$ # Then run the tool with the UDID of the device.
$ rvictl -s 74bd53c647548234ddcef0ee3abee616005051ed

Starting device 74bd53c647548234ddcef0ee3abee616005051ed [SUCCEEDED]

$ # Get the list of interfaces again, and you can see the new virtual
$ # network interface, rvi0, added by the previous command.
$ ifconfig -l
lo0 gif0 stf0 en0 en1 p2p0 fw0 ppp0 utun0 rvi0
</code></pre>

<p>打开 Wireshark, 选择 rvi0 作为待抓包的接口。</p>

<h1>Reference</h1>

<p><a href="https://developer.apple.com/library/mac/qa/qa1176/_index.html">Getting a Packet Trace</a><br/>
<a href="http://stackoverflow.com/questions/9555403/capturing-mobile-phone-traffic-on-wireshark">Capturing mobile phone traffic on wireshark</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Web Development Notes Part One]]></title>
    <link href="http://DamianSheldon.github.io/blog/web-development-notes-part-one.html"/>
    <updated>2015-12-12T22:27:22+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/web-development-notes-part-one</id>
    <content type="html"><![CDATA[<h3>1. What is href=“#” and why is it used?</h3>

<p>Solution:A hashtag - # within a hyperlink specifies an html element id to which the window should be scrolled.<br/>
href=&ldquo;#some-id&rdquo; would scroll to an element on the current page such as <div id="some-id">.</p>

<p>href=&ldquo;//site.com/#some-id&rdquo; would go to site.com and scroll to the id on that page.</p>

<p>href=&ldquo;#&rdquo; doesn&rsquo;t specify an id name, but does have a corresponding location - the top of the page. Clicking an anchor with href=&ldquo;#&rdquo; will move the scroll position to the top.</p>

<p>Reference:<a href="http://stackoverflow.com/questions/4855168/what-is-href-and-why-is-it-used">http://stackoverflow.com/questions/4855168/what-is-href-and-why-is-it-used</a></p>

<h3>2. How to debug your web page, technology stack is LAMP.</h3>

<p>Solution:View log, figure out what cause problems.</p>

<pre><code>$ tail -f /var/log/apache2/error_log
[Fri Dec 11 21:34:57.003657 2015] [:error] [pid 17465] [client ::1:50505] PHP Parse error:  parse error, expecting `','' or `';'' in /Users/dongmeiliang/Sites/knowledgeispower/includes/header.html on line 7
[Fri Dec 11 21:34:57.003701 2015] [:error] [pid 17465] [client ::1:50505] PHP Stack trace:
[Fri Dec 11 21:34:57.003723 2015] [:error] [pid 17465] [client ::1:50505] PHP   1. {main}() /Users/dongmeiliang/Sites/knowledgeispower/index.php:0
</code></pre>

<!-- more -->


<h3>3. Install mcrypt_filter extension on El capitan</h3>

<pre><code>// Please make sure the PHP extensions listed below are installed.
mCrypt

// PECL is a repository of PHP extensions that are made available to you via the » PEAR packaging system. 

// There are several options for downloading PECL extensions, such as:
o The pecl install extname command downloads the extensions code automatically, so in this case there is no need for a separate download.
o » http://pecl.php.net/ The PECL web site contains information about the different extensions that are offered by the PHP Development Team. The information available here includes: ChangeLog, release notes, requirements and other similar details.
o pecl download extname PECL extensions that have releases listed on the PECL web site are available for download and installation using the » pecl command. Specific revisions may also be specified.
o SVN Most PECL extensions also reside in SVN. A web-based view may be seen at » http://svn.php.net/viewvc/pecl/. To download straight from SVN, the following sequence of commands may be used:

$ pecl search mCrypt
Retrieving data...0%
Matched packages, channel pecl.php.net:
=======================================
Package       Stable/(Latest) Local
mcrypt_filter 0.1.0 (beta)          Applies mcrypt symmetric encryption using stream filters

$ pecl install mcrypt_filter
Failed to download pecl/mcrypt_filter within preferred state "stable", latest release is version 0.1.0, stability "beta", use "channel://pecl.php.net/mcrypt_filter-0.1.0" to install
install failed

$ pecl install channel://pecl.php.net/mcrypt_filter-0.1.0/mcrypt_filter
Attempting to discover channel "pecl.php.net/mcrypt_filter-0.1.0"...
Attempting fallback to https instead of http on channel "pecl.php.net/mcrypt_filter-0.1.0"...
unknown channel "pecl.php.net/mcrypt_filter-0.1.0" in "channel://pecl.php.net/mcrypt_filter-0.1.0/mcrypt_filter"
invalid package name/package file "channel://pecl.php.net/mcrypt_filter-0.1.0/mcrypt_filter"
install failed

$ pecl install channel://pecl.php.net/mcrypt_filter-0.1.0
Cannot install, php_dir for channel "pecl.php.net" is not writeable by the current user
DongMeiliangsMacBook-Pro:upload dongmeiliang$ sudo pecl install channel://pecl.php.net/mcrypt_filter-0.1.0
Password:
downloading mcrypt_filter-0.1.0.tgz ...
Starting to download mcrypt_filter-0.1.0.tgz (4,586 bytes)
...
checking for mcrypt support... yes, shared
configure: error: mcrypt.h not found. Please reinstall libmcrypt.
ERROR: `/private/tmp/pear/install/mcrypt_filter/configure --with-php-config=/usr/bin/php-config' failed

// Resolve configure: error: mcrypt.h not found. Please reinstall libmcrypt.
Get libmcrypt 2.5.8 from Sourceforge: http://sourceforge.net/projects/mcrypt/files/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz/download

$ tar -zxvf libmcrypt-2.5.8.tar.gz
$ mkdir -p /usr/local/src
$ mv libmcrypt-2.5.8 /usr/local/src/
$ cd /usr/local/src/libmcrypt-2.5.8/
$ ./configure --prefix=/usr/local
$ make &amp;&amp; make install

// Continue install mCrypt extension
$ sudo pecl install channel://pecl.php.net/mcrypt_filter-0.1.0
...

12472464 40 -rwxr-xr-x  1 root  wheel  16704 Feb 15 21:41 /private/tmp/pear/install/pear-build-rootEyJ4Jg/install-mcrypt_filter-0.1.0/usr/lib/php/extensions/no-debug-non-zts-20121212/mcrypt_filter.so

Build process completed successfully
Installing '/usr/lib/php/extensions/no-debug-non-zts-20121212/mcrypt_filter.so'
ERROR: failed to write /usr/lib/php/extensions/no-debug-non-zts-20121212/mcrypt_filter.so (copy(/usr/lib/php/extensions/no-debug-non-zts-20121212/mcrypt_filter.so): failed to open stream: Operation not permitted)

We need to disable SIP.

OSX 10.11 El Capitan ships with a new security process referred to as SIP or Security Integrity Protection also known as rootless.

What this essentially does is protect certain system level directories from being changes, notably

o /System
o /sbin
o /usr
o not /usr/local

// Disabling SIP in OSX
o Reboot your Mac into Recovery Mode by rebooting and holding down ‘command’ + ‘r’
o Launch a Terminal session and enter csrutil disable
o Reboot

// Reinstall mCrypt extension
$ sudo pecl install channel://pecl.php.net/mcrypt_filter-0.1.0

...

Build process completed successfully
Installing '/usr/lib/php/extensions/no-debug-non-zts-20121212/mcrypt_filter.so'
install ok: channel://pecl.php.net/mcrypt_filter-0.1.0
configuration option "php_ini" is not set to php.ini location
You should add "extension=mcrypt_filter.so" to php.ini
</code></pre>

<p>Reference:<a href="http://www.nginx.cn/2196.html">http://www.nginx.cn/2196.html</a>
<a href="http://coolestguidesontheplanet.com/install-mcrypt-for-php-on-mac-osx-10-10-yosemite-for-a-development-server/">http://coolestguidesontheplanet.com/install-mcrypt-for-php-on-mac-osx-10-10-yosemite-for-a-development-server/</a></p>

<h3>4.Install mcrypt for php on Mac OSX 10.11 El Capitan</h3>

<p>o Disable SIP/rootless
You need to disable the new System Integrity Protection to install into some system protected directories – this involves a recovery reboot and disabling with.</p>

<pre><code>$ csrutil disable
</code></pre>

<p>o Getting it on in OS X El Capitan 10.11</p>

<pre><code>$ cd ~ ; mkdir mcrypt ; cd mcrypt
</code></pre>

<p><a href="http://sourceforge.net/projects/mcrypt/files/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz/download">Get libmcrypt 2.5.8 from Sourceforge</a>,  this is direct download link.</p>

<p><a href="http://php.net/releases/index.php">Get the php code in a tar.gz or .bz2 format</a>- (version 5.5.27 is the one that currently ships with OSX 10.11)</p>

<p>Move both of these files that you downloaded into your working directory – mcrypt in this instance, and go back to Terminal</p>

<pre><code>$ cd ~/mcrypt
</code></pre>

<p>Expand both files via the command line or just double click them in the Finder:</p>

<pre><code>$ tar -zxvf libmcrypt-2.5.8.tar.gz
$ tar -zxvf php-5.5.27.tar.gz
</code></pre>

<p>o Configuring libmcrypt</p>

<pre><code>$ cd libmcrypt-2.5.8
$ ./configure
$ make
$ sudo make install
</code></pre>

<p>o Compile mcrypt php Extension</p>

<pre><code>$ cd ../php-5.5.27/ext/mcrypt/
$ /usr/bin/phpize
$ ./configure
$ make
$ sudo make install
</code></pre>

<p>o Enabling mcrypt.so  php Extension</p>

<pre><code>// Open /etc/php.ini and add the line below at the end
extension=mcrypt.so

// If there is no php.ini file,  then you need to make one from php.ini.default in the same location like so:
$ sudo cp /etc/php.ini.default /etc/php.ini

// And allow write capability
$ sudo chmod u+w  /etc/php.ini

// Then add the line as above in your favourite text editor:
$ sudo vi /etc/php.ini

// make sure dynamic extensions are set to on…
extension_dl = On

// If it didn’t load you may need to declare the extensions directory in /etc/php.ini
extension_dir = "/usr/lib/php/extensions/no-debug-non-zts-20100525/"
</code></pre>

<p>o Restart Apache</p>

<pre><code>$ sudo apachectl restart
</code></pre>

<p>That’s it, create a php page with the function phpinfo();  to see if it loaded correctly.</p>

<p>Reference:<a href="http://coolestguidesontheplanet.com/install-mcrypt-for-php-on-mac-osx-10-10-yosemite-for-a-development-server/">http://coolestguidesontheplanet.com/install-mcrypt-for-php-on-mac-osx-10-10-yosemite-for-a-development-server/</a>
<a href="http://coolestguidesontheplanet.com/what-is-sip-in-osx-10-11-el-capitan/">http://coolestguidesontheplanet.com/what-is-sip-in-osx-10-11-el-capitan/</a></p>
]]></content>
  </entry>
  
</feed>
