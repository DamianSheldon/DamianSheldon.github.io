
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Git 小结  | Hello World</title>

<meta name="author" content="Sheldon"> 

<meta name="description" content="Sheldon's personal technology blog about iOS development, Networking, economic, english language, android app development, server back-end &hellip;"> <meta name="keywords" content="Git, Summary">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Hello World" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><!-- System header -->
<h1><a href="/">Hello World</a></h1>
<h4>Here's where it all happens for me.</h4>
<nav id="main-nav"><ul>
    <li><a href="/">Blog</a></li>
    <li><a href="/archives">Archive</a></li>
    <li><a href="/ios-development">iOS Development</a></li>
    <li><a href="/Android">Android</a></li>
    <li><a href="/english">English</a></li>
    <li><a href="/about">About</a></li>
</ul>

<!-- System navigation -->
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
    <li><a href="/">Blog</a></li>
    <li><a href="/archives">Archive</a></li>
    <li><a href="/ios-development">iOS Development</a></li>
    <li><a href="/Android">Android</a></li>
    <li><a href="/english">English</a></li>
    <li><a href="/about">About</a></li>
</ul>

<!-- System navigation -->
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:DamianSheldon.github.io">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">Git 小结</h2>
	<div class="entry-content"><h1>Git</h1>

<ol>
<li>Git是什么？</li>
<li>为什么使用Git?</li>
<li>如何使用Git?</li>
</ol>


<h2>Git是什么？</h2>

<p>git &ndash; the stupid content tracker</p>

<p>这是man git中对它的介绍，我们看到它的核心是content tracker。Git是一个分布式的版本控制系统，项目是出于维护Linux内核源码的需求, 由Linus Torvalds启动的，现在已经成为最流行的版本管理系统，学会Git几乎成了开发者的必备技能。</p>

<h2>为什么使用Git?</h2>

<ol>
<li>系统稳定，安全性高，不会丢失辛苦的劳动成果；</li>
<li>操作十分快速；</li>
<li>功能强大；</li>
<li>&hellip;</li>
</ol>


<h2>如何使用Git?</h2>

<h3>安装Git</h3>

<p>安装Git主要有两种方法：一种是通过编译源代码来安装;另一种是使用为特定平台预编译好的安装包。</p>

<!-- more -->


<h3>在服务器上布署Git</h3>

<p>尽管技术上可以从个人的仓库里推送和拉取改变,但是我们不鼓励这样做,因为一不留心就很 容易弄混其他人的进度。另外,你也一定希望合作者们即使在自己不开机的时候也能从仓库获取数据——拥有 一个更稳定的公共仓库十分有用。因此,更好的合作方式是建立一个大家都可以访问的共享仓库,从那里推送和拉取数据。我们将把这个仓库称为 “Git 服务器”;代理一个 Git 仓库只需要花费很少的资源,几乎从不 需要整个服务器来支持它的运行。</p>

<p>架设一个 Git 服务器有很多种选择，这里不打算展开，不是一下子能讲清楚的，让我们看个实例。架设一个使用SSH传输数据和使用 authorized_keys 方法来给用户授权的Git服务器：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// Step 1:创建一个 ‘git’ 用户并为其创建一个 .ssh 目录
</span><span class='line'><span class="nv">$ </span>sudo adduser git
</span><span class='line'><span class="nv">$ </span>su -l git
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ~
</span><span class='line'><span class="nv">$ </span>mkdir .ssh
</span><span class='line'>
</span><span class='line'>// Step 2:把开发者的 SSH 公钥添加到这个用户的 authorized_keys 文件中。
</span><span class='line'>// 假设你通过 e-mail 收到了几个 公钥并存到了临时文件里
</span><span class='line'><span class="nv">$ </span>cat /tmp/id_rsa.john.pub &gt;&gt; ~/.ssh/authorized_keys
</span><span class='line'><span class="nv">$ </span>cat /tmp/id_rsa.josie.pub &gt;&gt; ~/.ssh/authorized_keys
</span><span class='line'><span class="nv">$ </span>cat /tmp/id_rsa.jessica.pub &gt;&gt; ~/.ssh/authorized_keys
</span><span class='line'>
</span><span class='line'>// Preparation &amp; Accounts Setup
</span><span class='line'><span class="nv">$ </span>sudo useradd -G git -d /home/john -m -s /bin/bash john
</span><span class='line'><span class="nv">$ </span>sudo useradd -G git -d /home/andrew -m -s /bin/bash andrew
</span><span class='line'><span class="nv">$ </span>sudo useradd -G git -d /home/robert -m -s /bin/bash robert
</span><span class='line'>
</span><span class='line'>// Exist user change his primary group by newgrp <span class="nb">command</span>
</span><span class='line'><span class="nv">$ </span>sudo newgrp -g git john
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>// Step 3:使用 --bare 选项运行 git init 来设定一个空仓库,这会初始化一个不包含工作目录的仓库
</span><span class='line'><span class="nv">$sudo</span> mkdir /opt/git
</span><span class='line'><span class="nv">$sudo</span> chown -R git /opt/git
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /opt/git
</span><span class='line'><span class="nv">$ </span>mkdir project.git
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>project.git
</span><span class='line'><span class="nv">$ </span>git --bare --shared<span class="o">=</span>group init
</span><span class='line'>
</span><span class='line'>// <span class="k">if </span>forget init with --shared<span class="o">=</span>group, we can config with <span class="nb">command</span>:
</span><span class='line'><span class="nv">$ </span>git config -- core.sharedRepository ture
</span><span class='line'>
</span><span class='line'>// Mac 下需要开启ssh并允许remote login
</span><span class='line'><span class="nv">$launchctl</span> start sshd
</span><span class='line'>// System Preferences -&gt; Sharing -&gt; Remote Login -&gt; All Users
</span><span class='line'>
</span><span class='line'>// Step 4:Join,Josie 或者 Jessica 就可以把它加为远程仓库,
</span><span class='line'>推送一个分支,从而把第一个版本的工程上 传到仓库里了
</span><span class='line'><span class="c"># 在 John 的电脑上</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>myproject
</span><span class='line'><span class="nv">$ </span>git init
</span><span class='line'><span class="nv">$ </span>git add .
</span><span class='line'><span class="nv">$ </span>git commit -m <span class="s1">&#39;initial commit&#39;</span>
</span><span class='line'><span class="nv">$ </span>git remote add origin git@gitserver:/opt/git/project.git
</span><span class='line'><span class="nv">$ </span>git push origin master
</span><span class='line'>
</span><span class='line'>// Step 5:其他人的克隆和推送也一样变得很简单
</span><span class='line'><span class="nv">$ </span>git clone git@gitserver:/opt/git/project.git <span class="nv">$ </span>vim README
</span><span class='line'><span class="nv">$ </span>git commit -am <span class="s1">&#39;fix for the README file&#39;</span>
</span><span class='line'><span class="nv">$ </span>git push origin master
</span><span class='line'>
</span><span class='line'>// Step 6:用这个方法可以很快捷的为少数几个开发者架设一个可读写的 Git 服务
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>// 如何生成 SSH 公钥？
</span><span class='line'>// Step 1:首先,确定一下是否已经有一个公钥了。SSH 公钥默认储存 在账户的 ~/.ssh 目录。
</span><span class='line'>// 进入那里并查看其内容,有没有公钥一目了然:
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> ~/.ssh
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>authorized_keys2 id_dsa known_hosts config id_dsa.pub
</span><span class='line'>
</span><span class='line'>// Step 2:关键是看有没有用 文件名 和 文件名.pub 来命名的一对文件,
</span><span class='line'>// 这个 文件名 通常是 id_dsa 或者 id_rsa。 .pub 文件是公钥,另一个文件是密钥。
</span><span class='line'>// 假如没有这些文件<span class="o">(</span>或者干脆连 .ssh 目录都没有<span class="o">)</span>,你可以用 ssh- keygen 的程序来建立它们,
</span><span class='line'>// 该程序在 Linux/Mac 系统由 SSH 包提供, 在 Windows 上则包含在 MSysGit 包 里:
</span><span class='line'><span class="nv">$ </span>ssh-keygen
</span><span class='line'>Generating public/private rsa key pair.
</span><span class='line'>Enter file in which to save the key <span class="o">(</span>/Users/schacon/.ssh/id_rsa<span class="o">)</span>:
</span><span class='line'>Enter passphrase <span class="o">(</span>empty <span class="k">for </span>no passphrase<span class="o">)</span>:
</span><span class='line'>Enter same passphrase again:
</span><span class='line'>Your identification has been saved in /Users/schacon/.ssh/id_rsa.
</span><span class='line'>Your public key has been saved in /Users/schacon/.ssh/id_rsa.pub.
</span><span class='line'>The key fingerprint is:
</span><span class='line'>43:c5:5b:5f:b1:f1:50:43:ad:20:a6:92:6a:1f:9a:3a schacon@agadorlaptop.local
</span><span class='line'>
</span><span class='line'>// Step 3:它先要求你确认保存公钥的位置<span class="o">(</span>.ssh/id_rsa<span class="o">)</span>,然后它会让你重复一个密码两次,
</span><span class='line'>// 如果不想在使用公钥的 时候输入密码,可以留空。
</span><span class='line'>// 现在,所有做过这一步的用户都得把它们的公钥给你
</span><span class='line'>// 或者 Git 服务器的管理者<span class="o">(</span>假设 SSH 服务被设定为使 用公钥机制<span class="o">)</span>。
</span><span class='line'>// 他们只需要复制 .put 文件的内容然后 e-email 之。公钥的样子大致如下:
</span><span class='line'><span class="nv">$ </span>cat ~/.ssh/id_rsa.pub
</span><span class='line'>ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAklOUpkDHrfHY17SbrmTIpNLTGK9Tjom/BWDSU
</span><span class='line'>GPl+nafzlHDTYW7hdI4yZ5ew18JH4JW9jbhUFrviQzM7xlELEVf4h9lFX5QVkbPppSwg0cda3
</span><span class='line'>Pbv7kOdJ/MTyBlWXFCR+HAo3FXRitBqxiX1nKhXpHAZsMciLq8V6RjsNAQwdsdMFvSlVK/7XA
</span><span class='line'>t3FaoJoAsncM1Q9x5+3V0Ww68/eIFmb1zuUFljQJKprrX88XypNDvjYNby6vw/Pb0rwert/En
</span><span class='line'>mZ+AW4OZPnTPI89ZPmVMLuayrD2cE86Z/il8b+gw3r3+1nKatmIkjn2so1d01QraTlMqVSsbx
</span><span class='line'>NrRFi9wrf+M7Q<span class="o">==</span> schacon@agadorlaptop.local
</span></code></pre></td></tr></table></div></figure>


<p>作为一个额外的防范措施,你可以用 Git 自带的 git-shell 简单工具来把 git 用户的活动限制在仅与 Git 相关。把它设为 git 用户登入的 shell,那么该用户就不能拥有主机正常的 shell 访问权。为了实现这一 点,需要指明用户的登入shell 是 git-shell ,而不是 bash 或者 csh。你可能得编辑 /etc/passwd 文件:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// Step 1:
</span><span class='line'><span class="nv">$ </span>sudo vim /etc/passwd
</span><span class='line'>
</span><span class='line'>// Step 2:在文件末尾,你应该能找到类似这样的行
</span><span class='line'>git:x:1000:1000::/home/git:/bin/sh
</span><span class='line'>
</span><span class='line'>// Step 3:把 bin/sh 改为 /usr/bin/git-shell <span class="o">(</span>或者用 which git-shell 查看它的位置<span class="o">)</span>。该行修改后的样子如下
</span><span class='line'>git:x:1000:1000::/home/git:/usr/bin/git-shell
</span><span class='line'>
</span><span class='line'>// Step 4:现在 git 用户只能用 SSH 连接来推送和获取 Git 仓库,而不能直接使用主机 shell。
</span><span class='line'>// 尝试登录的话,你会 看到下面这样的拒绝信息
</span><span class='line'><span class="nv">$ </span>ssh git@gitserver
</span><span class='line'>fatal: What <span class="k">do </span>you think I am? A shell? <span class="o">(</span>你以为我是个啥?shell吗?<span class="o">)</span>
</span><span class='line'>Connection to gitserver closed. <span class="o">(</span>gitserver 连接已断开。<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Git基础</h3>

<p>为了和其他人愉快地的合作开发，我们要掌握Git的基本命令。你不会想看到人民群众仇恨你。  <br/>
1)Git基础要点; <br/>
2)配置Git; <br/>
3)Git分支;
4)记录每次更新到仓库;  <br/>
5)撤消操作; <br/>
6)远程仓库的使用;  <br/>
7)打标签;  <br/>
8)查看提交历史。</p>

<h4>Git基础要点</h4>

<p>对于任何一个文件,在 Git 内都只有三种状态:已提交 (committed),已修改(modified)和已暂存(staged)。已提交表示该文件已经被安全地保存在本地数据 库中了;已修改表示修改了某个文件,但还没有提交保存;已暂存表示把已修改的文件放在下次提交时要保存 的清单中。
由此我们看到 Git 管理项目时,文件流转的三个工作区域:Git 的本地数据目录,工作目录以及暂存区域。</p>

<p>每个项目都有一个 git 目录,它是 Git 用来保存元数据和对象数据库的地方。该目录非常重要,每次克隆 镜像仓库的时候,实际拷贝的就是这个目录里面的数据。
从项目中取出某个版本的所有文件和目录,用以开始后续工作的叫做工作目录。这些文件实际上都是从 git 目录中的压缩对象数据库中提取出来的,接下来就可以在工作目录中对这些文件进行编辑。
所谓的暂存区域只不过是个简单的文件,一般都放在 git 目录中。有时候人们会把这个文件叫做索引文件,不过标准说法还是叫暂存区域。</p>

<p>基本的 Git 工作流程如下:  <br/>
a)在工作目录中修改某些文件;  <br/>
b)对这些修改了的文件作快照,并保存到暂存区域;  <br/>
c)提交更新,将保存在暂存区域的文件快照转储到 git 目录中.</p>

<h5>配置Git</h5>

<p>一般在新的系统上,我们都需要先配置下自己的 Git 工作环境。配置工作只需一次,以后升级时还会沿用 现在的配置。当然,如果需要,你随时可以用相同的命令修改已有的配置。</p>

<p>Git 提供了一个叫做 git config 的工具(译注:实际是 git-config 命令,只不过可以通过 git 加一个 名字来呼叫此命令。),专门用来配置或读取相应的工作环境变量。而正是由这些环境变量,决定了 Git 在 各个环节的具体工作方式和行为。这些变量可以存放在以下三个不同的地方:  <br/>
1)/etc/gitconfig文件:系统中对所有用户都普遍适用的配置。若使用 git config 时用 &mdash;system 选项,读写 的就是这个文件。  <br/>
2)~/.gitconfig文件:用户目录下的配置文件只适用于该用户。若使用 git config 时用 &mdash;global 选项,读写 的就是这个文件。 <br/>
3)当前项目的 git 目录中的配置文件(也就是工作目录中的 .git/config 文件):这里的配置仅仅针对当前 项目有效。每一个级别的配置都会覆盖上层的相同配置,所以 .git/config 里的配置会覆盖 /etc/gitconfig 中的同名变量。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// Quilk config
</span><span class='line'>// 用户信息
</span><span class='line'><span class="nv">$ </span>git config --global user.name <span class="s2">&quot;John Doe&quot;</span>
</span><span class='line'><span class="nv">$ </span>git config --global user.email johndoe@example.com
</span><span class='line'>
</span><span class='line'>// 文本编辑器
</span><span class='line'><span class="nv">$ </span>git config --global core.editor emacs
</span><span class='line'>
</span><span class='line'>// 差异分析工具
</span><span class='line'><span class="nv">$ </span>git config --global merge.tool vimdiff
</span><span class='line'>
</span><span class='line'>// 查看配置信息
</span><span class='line'><span class="nv">$ </span>git config --list
</span></code></pre></td></tr></table></div></figure>


<h5>Git分支</h5>

<p>几乎每一种版本控制系统都以某种形式支持分支。使用分支意味着你可以从开发主线上分离开来,然后在不影响主线的同时继续工作。
1)新建分支;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// 新建本地分支
</span><span class='line'>git branch <span class="o">[</span>--set-upstream | --track | --no-track<span class="o">]</span> <span class="o">[</span>-l<span class="o">]</span> <span class="o">[</span>-f<span class="o">]</span> &lt;branchname&gt; <span class="o">[</span>&lt;start-point&gt;<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>--set-upstream
</span><span class='line'>如果指定的分支不存在，或者指定了--force参数，作用和--track一样。
</span><span class='line'>否则当创建分支时建立像--track一样的配置，除了分支的指向没有改变。
</span><span class='line'>
</span><span class='line'>--track
</span><span class='line'>
</span><span class='line'>当创建新的分支，从新分支建立branch.&lt;name&gt;.remote和branch.&lt;name&gt;.merge的配置入口
</span><span class='line'>去标记start-point 分支作为“upstream”。
</span><span class='line'>这个配置会告诉git在git status和git branch -v中显示两个分支的关系。
</span><span class='line'>而且，当新的分支被检出时，它会引导git pull在没带参数时去从upstream拉代码。
</span><span class='line'>
</span><span class='line'>当我们的start point是remote-tracking分支时，这一行为是默认的。
</span><span class='line'>如果你想让git checkout和git branch总是像给定--no-track一样执行，设置branch.autosetupmerge 配置变量为false。
</span><span class='line'>当start-point是local或remote-tracking分支时，上述行为是你想要的，那么设置它为always。
</span><span class='line'>
</span><span class='line'>--no-track
</span><span class='line'>不建立<span class="s2">&quot;upstream&quot;</span>配置，即使branch.autosetupmerge配置变量的值是true。
</span><span class='line'>
</span><span class='line'>-l
</span><span class='line'>创建分支的引用日志。它会激活对分支引用所有改变模式的记录，开启使用基于sha1表达式的日期，
</span><span class='line'>如<span class="s2">&quot;&lt;branchname&gt;@{yesterday}&quot;</span>。
</span><span class='line'>注意在non-bare仓库中，引用日志由于core.logallrefupdates配置选项默认都开启的。
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>-f
</span><span class='line'>如果&lt;branchname&gt;已经存在，重置&lt;branchname&gt;到&lt;startpoint&gt;。没有-f git branch将会拒绝改变。
</span><span class='line'>
</span><span class='line'>&lt;branchname&gt;
</span><span class='line'>要创建或删除分支的名称。新分支的名称必须通过git-check-ref-format<span class="o">(</span>1<span class="o">)</span>定义的所有检查。
</span><span class='line'>有些检查会限制分支名称中能使用的字符。
</span><span class='line'>
</span><span class='line'>&lt;start-point&gt;
</span><span class='line'>已经存在的分支名，对它应用和&lt;branchname&gt;相同的限制。
</span><span class='line'>
</span><span class='line'>如果我们没有指定&lt;start-point&gt;,它默认是HEAD。
</span><span class='line'><span class="nv">$git</span> branch &lt;branchname&gt; &lt;start-point&gt;
</span><span class='line'>
</span><span class='line'>// 新建远程仓库分支
</span><span class='line'>git push <span class="o">[</span>远程名<span class="o">]</span> <span class="o">[</span>本地分支<span class="o">]</span>:<span class="o">[</span>远程分支<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>2)删除分支;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// 删除本地分支
</span><span class='line'><span class="nv">$ </span>git branch -d &lt;branchname&gt;
</span><span class='line'>
</span><span class='line'>// 删除远程分支
</span><span class='line'>// 如果想在服务器上删 除 serverfix 分支,运行下面的命令:
</span><span class='line'><span class="nv">$ </span>git push origin :serverfix
</span><span class='line'>To git@github.com:schacon/simplegit.git
</span><span class='line'>- <span class="o">[</span>deleted<span class="o">]</span> serverfix
</span></code></pre></td></tr></table></div></figure>


<p>3)切换分支;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git checkout &lt;branchname&gt;
</span></code></pre></td></tr></table></div></figure>


<p>4)合并分支;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// 将sourceBranchname合并到destinationBranchname
</span><span class='line'><span class="nv">$git</span> checkout destinationBranchname
</span><span class='line'><span class="nv">$git</span> merge sourceBranchname
</span></code></pre></td></tr></table></div></figure>


<p>5)衍合分支。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// 把一个分支整合到另一个分支的办法有两种:merge<span class="o">(</span>合并<span class="o">)</span> 和 rebase<span class="o">(</span>衍合<span class="o">)</span>。
</span><span class='line'>// 把在 branchA 里产生的变化补丁重新在 branchB 的基础上打一遍。在 Git 里,这种 操作叫做衍合<span class="o">(</span>rebase<span class="o">)</span>。
</span><span class='line'>// 有了 rebase 命令,就可以把在一个分支里提交的改变在另一个分支里重放一遍。
</span><span class='line'>// 例如将experiment衍合到master分支:
</span><span class='line'><span class="nv">$ </span>git checkout experiment
</span><span class='line'><span class="nv">$ </span>git rebase master
</span><span class='line'>First, rewinding head to replay your work on top of it... Applying: added staged <span class="nb">command</span>
</span></code></pre></td></tr></table></div></figure>


<p>关于如何进行分支管理，可以看看阮一峰老师的<a href="http://www.ruanyifeng.com/blog/2012/07/git.html">这篇博文</a>。</p>

<h5>记录每次更新到仓库</h5>

<p>版本控制的主要作用就是记录我们的更新，如果我们不将更新记录到远程仓库就失去意义了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// 检查当前文件状态
</span><span class='line'><span class="nv">$ </span>git status
</span><span class='line'><span class="c"># On branch master</span>
</span><span class='line'>nothing to commit <span class="o">(</span>working directory clean<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>// 跟踪新文件
</span><span class='line'><span class="nv">$ </span>git add newFilename
</span><span class='line'>
</span><span class='line'>// 暂存已修改文件
</span><span class='line'><span class="nv">$ </span>git add trackedFilename
</span><span class='line'>
</span><span class='line'>// 忽略某些文件
</span><span class='line'>//一般我们总会有些文件无需纳入 Git 的管理,也不希望它们总出现在未跟踪文件列表。
</span><span class='line'>通常都是些自动生成的文件,像是日志或者编译过程中创建的等等。
</span><span class='line'>我们可以创建一个名为 .gitignore 的文件,列出要忽略的 文件模式。
</span><span class='line'>
</span><span class='line'>// 文件 .gitignore 的格式规范如下:
</span><span class='line'>// 1<span class="o">)</span>所有空行或者以注释符号 <span class="c"># 开头的行都会被 Git 忽略。</span>
</span><span class='line'>// 2<span class="o">)</span>可以使用标准的 glob 模式匹配, 所谓的 glob 模式是指 shell 所使用的简化了的正则表达式。
</span><span class='line'>// 3<span class="o">)</span>匹配模式最后跟反斜杠<span class="o">(</span>/<span class="o">)</span>说明要忽略的是目录。
</span><span class='line'>/*
</span><span class='line'><span class="c"># 此为注释 – 将被 Git 忽略</span>
</span><span class='line'>*.a <span class="c"># 忽略所有 .a 结尾的文件</span>
</span><span class='line'>!lib.a <span class="c"># 但 lib.a 除外</span>
</span><span class='line'>/TODO <span class="c"># 仅仅忽略项目根目录下的 TODO 文件,不包括 subdir/TODO build/ # 忽略 build/ 目录下的所有文件</span>
</span><span class='line'>doc/*.txt <span class="c"># 会忽略 doc/notes.txt 但不包括 doc/server/arch.txt</span>
</span><span class='line'>*/
</span><span class='line'>
</span><span class='line'>// 查看已暂存和未暂存的更新
</span><span class='line'>// 实际上 git status 的显示比较简单,仅仅是列出了修改过的文件,如果要查看具体修改了什么地方,可以用 git diff 命令。
</span><span class='line'><span class="nv">$ </span>git diff
</span><span class='line'>diff --git a/benchmarks.rb b/benchmarks.rb index 3cb747f..da65585 100644
</span><span class='line'>--- a/benchmarks.rb
</span><span class='line'>+++ b/benchmarks.rb
</span><span class='line'>@@ -36,6
</span><span class='line'>+ + + +
</span><span class='line'>+36,10 @@ def main @commit.parents<span class="o">[</span>0<span class="o">]</span>.parents<span class="o">[</span>0<span class="o">]</span>.parents<span class="o">[</span>0<span class="o">]</span>
</span><span class='line'>end
</span><span class='line'>run_code<span class="o">(</span>x, <span class="s1">&#39;commits 1&#39;</span><span class="o">)</span> <span class="k">do </span>git.commits.size
</span><span class='line'>end
</span><span class='line'>run_code<span class="o">(</span>x, <span class="s1">&#39;commits 2&#39;</span><span class="o">)</span> <span class="k">do</span>
</span><span class='line'><span class="nv">log</span> <span class="o">=</span> git.commits<span class="o">(</span><span class="s1">&#39;master&#39;</span>, 15<span class="o">)</span> log.size
</span><span class='line'>
</span><span class='line'>// 若要看已经暂存起来的文件和上次提交时的快照之间的差异,可以用 git diff --cached 命令。
</span><span class='line'>
</span><span class='line'>// 提交更新
</span><span class='line'><span class="nv">$ </span>git commit
</span><span class='line'>
</span><span class='line'>// 跳过使用暂存区域
</span><span class='line'>// 尽管使用暂存区域的方式可以精心准备要提交的细节,但有时候这么做略显繁琐。
</span><span class='line'>Git 提供了一个跳过使用 暂存区域的方式,只要在提交的时候,给 git commit 加上 -a 选项,
</span><span class='line'>Git 就会自动把所有已经跟踪过的文件暂存起来一并提交,从而跳过 git add 步骤:
</span><span class='line'><span class="nv">$ </span>git commit -a -m <span class="s1">&#39;added new benchmarks&#39;</span>
</span><span class='line'><span class="o">[</span>master 83e38c7<span class="o">]</span> added new benchmarks
</span><span class='line'>1 files changed, 5 insertions<span class="o">(</span>+<span class="o">)</span>, 0 deletions<span class="o">(</span>-<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>// 移除文件
</span><span class='line'>// 要从 Git 中移除某个文件,就必须要从已跟踪文件清单中移除<span class="o">(</span>确切地说,是从暂存区域移除<span class="o">)</span>,然后提交。
</span><span class='line'>可以用 git rm 命令完成此项工作,并连带从工作目录中删除指定的文件,这样以后就不会出现在未跟踪 文件清单中了。
</span><span class='line'>// 如果只是简单地从工作目录中手工删除文件,运行 git status 时就会在 “Changed but not updated” 部分<span class="o">(</span>也就是_未暂存_清单<span class="o">)</span>看到。
</span><span class='line'>
</span><span class='line'>// 移动文件
</span><span class='line'><span class="nv">$ </span>git mv file_from file_to
</span></code></pre></td></tr></table></div></figure>


<h5>撤消操作</h5>

<p>任何时候,你都有可能需要撤消刚才所做的某些操作。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// 修改最后一次提交
</span><span class='line'>// 有时候我们提交完了才发现漏掉了几个文件没有加,或者提交信息写错了。想要撤消刚才的提交操作,可以 使用 --amend 选项重新提交:
</span><span class='line'><span class="nv">$ </span>git commit --amend
</span><span class='line'>
</span><span class='line'>// 取消已经暂存的文件
</span><span class='line'>git reset HEAD &lt;file&gt;...
</span><span class='line'>
</span><span class='line'>// 取消对文件的修改
</span><span class='line'>use <span class="s2">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory
</span></code></pre></td></tr></table></div></figure>


<h5>远程仓库的使用</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// 查看当前的远程库
</span><span class='line'>git remote <span class="o">[</span>-v<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>// 添加远程仓库
</span><span class='line'>git remote add <span class="o">[</span>shortname<span class="o">]</span> <span class="o">[</span>url<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>// Add a remote repo implementate ssh protocol
</span><span class='line'>git remote add origin ssh://dongmeiliang@localhost/git/ToDoList.git
</span><span class='line'>
</span><span class='line'>// 从远程仓库抓取数据
</span><span class='line'><span class="nv">$ </span>git fetch <span class="o">[</span>remote-name<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>// 推送数据到远程仓库
</span><span class='line'>git push <span class="o">[</span>remote-name<span class="o">]</span> <span class="o">[</span>branch-name<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>// 查看远程仓库信息
</span><span class='line'>git remote show <span class="o">[</span>remote-name<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>// 远程仓库的删除和重命名
</span><span class='line'>// 可以用 git remote rename 命令修改某个远程仓库的简短名称,比如想把 pb 改成 paul,可以这么运行:
</span><span class='line'><span class="nv">$ </span>git remote rename pb paul <span class="nv">$ </span>git remote
</span><span class='line'>origin
</span><span class='line'>paul
</span><span class='line'>
</span><span class='line'>// 移除 对应的远端仓库,可以运行 git remote rm 命令:
</span><span class='line'><span class="nv">$ </span>git remote rm paul <span class="nv">$ </span>git remote
</span><span class='line'>origin
</span></code></pre></td></tr></table></div></figure>


<h5>打标签</h5>

<p>人们在发布某个软件版本(比如 v1.0 等等)的时候,经常会打上一标签。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// 列显已有的标签
</span><span class='line'><span class="nv">$ </span>git tag v0.1
</span><span class='line'>v1.3
</span><span class='line'>
</span><span class='line'>// 新建标签
</span><span class='line'>// Git 使用的标签有两种类型:轻量级的<span class="o">(</span>lightweight<span class="o">)</span>和含附注的<span class="o">(</span>annotated<span class="o">)</span>。
</span><span class='line'>轻量级标签就像是个不 会变化的分支,实际上它就是个指向特定提交对象的引用。
</span><span class='line'>而含附注标签,实际上是存储在仓库中的一个独立 对象,它有自身的校验和信息,
</span><span class='line'>包含着标签的名字,电子邮件地址和日期,以及标签说明,标签本身也允许使 用 GNU Privacy Guard <span class="o">(</span>GPG<span class="o">)</span> 来签署或验证。
</span><span class='line'>一般我们都建议使用含附注型的标签,以便保留相关信息;
</span><span class='line'>当然,如果只是临时性加注标签,或者不需要旁注额外信息,用轻量级标签也没问题。
</span><span class='line'>
</span><span class='line'>// 创建一个含附注类型的标签非常简单,用 -a <span class="o">(</span>译注:取 annotated 的首字母<span class="o">)</span>指定标签名字即可:
</span><span class='line'><span class="nv">$ </span>git tag -a v1.4 -m <span class="s1">&#39;my version 1.4&#39;</span>
</span><span class='line'>
</span><span class='line'>// 可以使用 git show 命令查看相应标签的版本信息,并连同显示打标签时的提交对象。
</span><span class='line'><span class="nv">$ </span>git show v1.4
</span><span class='line'>tag v1.4
</span><span class='line'>Tagger: Scott Chacon &lt;schacon@gee-mail.com&gt; Date: Mon Feb 9 14:45:11 2009 -0800
</span><span class='line'>my version 1.4
</span><span class='line'>commit 15027957951b64cf874c3557a0f3547bd83b3ff6 Merge: 4a447f7... a6b4c97...
</span><span class='line'>Author: Scott Chacon &lt;schacon@gee-mail.com&gt; Date: Sun Feb 8 19:02:46 2009 -0800
</span><span class='line'>Merge branch <span class="s1">&#39;experiment&#39;</span>
</span><span class='line'>
</span><span class='line'>// 签署标签
</span><span class='line'>//如果你有自己的私钥,还可以用 GPG 来签署标签,只需要把之前的 -a 改为 -s <span class="o">(</span>译注: 取 Signed 的首
</span><span class='line'>字母<span class="o">)</span>即可:
</span><span class='line'><span class="nv">$ </span>git tag -s v1.5 -m <span class="s1">&#39;my signed 1.5 tag&#39;</span>
</span><span class='line'>You need a passphrase to unlock the secret key <span class="k">for </span>user: <span class="s2">&quot;Scott Chacon &lt;schacon@gee-mail.com&gt;&quot;</span>
</span><span class='line'>1024-bit DSA key, ID F721C45A, created 2009-02-09
</span><span class='line'>
</span><span class='line'>// 轻量级标签
</span><span class='line'>// 轻量级标签实际上就是一个保存着对应提交对象的校验和信息的文件。
</span><span class='line'>要创建这样的标签,一个 -a,-s 或 -m 选项都不用,直接给出标签名字即可:
</span><span class='line'><span class="nv">$ </span>git tag v1.4-lw
</span><span class='line'>
</span><span class='line'>// 验证标签
</span><span class='line'>// 可以使用 git tag -v <span class="o">[</span>tag-name<span class="o">]</span> <span class="o">(</span>译注:取 verify 的首字母<span class="o">)</span>的方式验证已经签署的标签。
</span><span class='line'>此命令会调用 GPG 来验证签名,所以你需要有签署者的公钥,存放在 keyring 中,才能验证:
</span><span class='line'><span class="nv">$ </span>git tag -v v1.4.2.1
</span><span class='line'>object 883653babd8ee7ea23e6a5c392bb739348b1eb61
</span><span class='line'><span class="nb">type </span>commit
</span><span class='line'>tag v1.4.2.1
</span><span class='line'>tagger Junio C Hamano &lt;junkio@cox.net&gt; 1158138501 -0700
</span><span class='line'>GIT 1.4.2.1
</span><span class='line'>Minor fixes since 1.4.2, including git-mv and git-http with alternates.
</span><span class='line'>gpg: Signature made Wed Sep 13 02:08:25 2006 PDT using DSA key ID F3119B9A
</span><span class='line'>gpg: Good signature from <span class="s2">&quot;Junio C Hamano &lt;junkio@cox.net&gt;&quot;</span>
</span><span class='line'>gpg: aka <span class="s2">&quot;[jpeg image of size 1513]&quot;</span>
</span><span class='line'>Primary key fingerprint: 3565 2A26 2040 E066 C9A7 4A7D C0C6 D9A4 F311 9B9A
</span><span class='line'>
</span><span class='line'>// 后期加注标签
</span><span class='line'>// 比如在下面展示的提交历史中:
</span><span class='line'><span class="nv">$ </span>git log --pretty<span class="o">=</span>oneline
</span><span class='line'>15027957951b64cf874c3557a0f3547bd83b3ff6 Merge branch <span class="s1">&#39;experiment&#39;</span>
</span><span class='line'>a6b4c97498bd301d84096da251c98a07c7723e65 beginning write support
</span><span class='line'>0d52aaab4479697da7686c15f77a3d64d9165190 one more thing
</span><span class='line'>6d52a271eda8725415634dd79daabbc4d9b6008e Merge branch <span class="s1">&#39;experiment&#39;</span>
</span><span class='line'>0b7434d86859cc7b8c3d5e1dddfed66ff742fcbc added a commit <span class="k">function </span>
</span><span class='line'>4682c3261057305bdd616e23b64b0857d832627b added a todo file
</span><span class='line'>166ae0c4d3f420721acbb115cc33848dfcc2121a started write support
</span><span class='line'>9fceb02d0ae598e95dc970b74767f19372d61af8 updated rakefile
</span><span class='line'>964f16d36dfccde844893cac5b347e7b3d44abbc commit the todo
</span><span class='line'>8a5cbc430f1a9c3d00faaeffd07798508422908a updated readme
</span><span class='line'>
</span><span class='line'>// 我们忘了在提交 “updated rakefile” 后为此项目打上版本号 v1.2,没关系,现在也能做。
</span><span class='line'>只要在打标 签的时候跟上对应提交对象的校验和<span class="o">(</span>或前几位字符<span class="o">)</span>即可:
</span><span class='line'><span class="nv">$ </span>git tag -a v1.2 9fceb02
</span><span class='line'>
</span><span class='line'>// 分享标签
</span><span class='line'>// 默认情况下,git push 并不会把标签传送到远端服务器上,只有通过显式命令才能分享标签到远端仓库。
</span><span class='line'>其命令格式如同推送分支,运行 git push origin <span class="o">[</span>tagname<span class="o">]</span> 即可:
</span><span class='line'><span class="nv">$ </span>git push origin v1.5
</span><span class='line'>Counting objects: 50, <span class="k">done</span>.
</span><span class='line'>Compressing objects: 100% <span class="o">(</span>38/38<span class="o">)</span>, <span class="k">done</span>. Writing objects: 100% <span class="o">(</span>44/44<span class="o">)</span>, 4.56 KiB, <span class="k">done</span>.
</span><span class='line'>Total 44 <span class="o">(</span>delta 18<span class="o">)</span>, reused 8 <span class="o">(</span>delta 1<span class="o">)</span>
</span><span class='line'>To git@github.com:schacon/simplegit.git
</span><span class='line'>* <span class="o">[</span>new tag<span class="o">]</span> v1.5 -&gt; v1.5
</span><span class='line'>
</span><span class='line'>// 如果要一次推送所有<span class="o">(</span>本地新增的<span class="o">)</span>标签上去,可以使用 --tags 选项:
</span><span class='line'><span class="nv">$ </span>git push origin --tags
</span></code></pre></td></tr></table></div></figure>


<h5>查看提交历史</h5>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// 在提交了若干更新之后,又或者克隆了某个项目,想回顾下提交历史,可以使用 git log 命令。
</span><span class='line'>
</span><span class='line'>// 我们常用 -p 选项展开显示每次提交的内容差异,用 -2 则仅显示最近的两次更新:
</span><span class='line'><span class="nv">$ </span>git log –p -2
</span><span class='line'>
</span><span class='line'>// 还有 许多摘要选项可以用,比如 --stat,仅显示简要的增改行数统计:
</span><span class='line'><span class="nv">$git</span> log --stat
</span><span class='line'>
</span><span class='line'>// 限制输出长度
</span><span class='line'>// 列出所有最近两周内的提交
</span><span class='line'><span class="nv">$ </span>git log --since<span class="o">=</span>2.weeks
</span></code></pre></td></tr></table></div></figure>


<h3>分布式工作流程</h3>

<p>在服务器上布暑好了Git，并建好代码仓库以后，团队成员就可以愉快地合作开发了。由于团队的规模不一样，工作流程也会略有区别，我们先通过最简单的私有的小型团队来掌握基本的流程，其他的情况也就容易理解了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>//一个私有项目,与你一起协作的还有另外一到两位开发者。这里说私有,是指源代码不公开,其他人无法访问项目仓库。
</span><span class='line'>
</span><span class='line'><span class="c"># John&#39;s Machine</span>
</span><span class='line'>// Step 1: 克隆一份项目代码到本地
</span><span class='line'><span class="nv">$ </span>git clone john@githost:simplegit.git
</span><span class='line'>Initialized empty Git repository in /home/john/simplegit/.git/ ...
</span><span class='line'>
</span><span class='line'>// Step 2: 打开项目，编辑，完成属于自己的任务
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>simplegit/
</span><span class='line'><span class="nv">$ </span>vim lib/simplegit.rb
</span><span class='line'>
</span><span class='line'>// Step 3:更新项目，因为在你完成任务的时间窗口中团队其他成员可能提交过代码
</span><span class='line'><span class="nv">$ </span>git fetch origin
</span><span class='line'>...
</span><span class='line'>From john@githost:simplegit
</span><span class='line'>+ 049d078...fbff5bc master -&gt; origin/master
</span><span class='line'>
</span><span class='line'>// Step 4:合并分支，将团队成员的代码和自己的代码合并到一起
</span><span class='line'><span class="nv">$ </span>git merge origin/master Merge made by recursive.
</span><span class='line'>TODO | 1 +
</span><span class='line'>1 files changed, 1 insertions<span class="o">(</span>+<span class="o">)</span>, 0 deletions<span class="o">(</span>-<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>// Step 5:合并分支冲突时
</span><span class='line'><span class="nv">$git</span> status
</span><span class='line'>
</span><span class='line'>index.html: needs merge
</span><span class='line'><span class="c"># # # # # # #</span>
</span><span class='line'>On branch master
</span><span class='line'>Changed but not updated:
</span><span class='line'><span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed<span class="o">)</span>
</span><span class='line'><span class="o">(</span>use <span class="s2">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="o">)</span>
</span><span class='line'>unmerged: index.html
</span><span class='line'>
</span><span class='line'>// 任何包含未解决冲突的文件都会以未合并<span class="o">(</span>unmerged<span class="o">)</span>状态列出。
</span><span class='line'>Git 会在有冲突的文件里加入标准的冲突 解决标记,可以通过它们来手工定位并解决这些冲突。
</span><span class='line'>可以看到此文件包含类似下面这样的部分:
</span><span class='line'><span class="o">&lt;&lt;&lt;&lt;&lt;&lt;</span>&lt; HEAD:index.html
</span><span class='line'>&lt;div <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;footer&quot;</span>&gt;contact : email.support@github.com&lt;/div&gt;
</span><span class='line'><span class="o">=======</span>
</span><span class='line'>&lt;div <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;footer&quot;</span>&gt;
</span><span class='line'>please contact us at support@github.com &lt;/div&gt;
</span><span class='line'>&gt;&gt;&gt;&gt;&gt;&gt;&gt; iss53:index.html
</span><span class='line'>
</span><span class='line'>// 可以看到 <span class="o">=======</span> 隔开的上半部分,是 HEAD<span class="o">(</span>即 master 分支,在运行 merge 命令时检出的分支<span class="o">)</span>中的内 容,
</span><span class='line'>下半部分是在 iss53 分支中的内容。解决冲突的办法无非是二者选其一或者由你亲自整合到一起。
</span><span class='line'>比如你可以通过把这段内容替换为下面这样来解决:
</span><span class='line'>&lt;div <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;footer&quot;</span>&gt;
</span><span class='line'>please contact us at email.support@github.com &lt;/div&gt;
</span><span class='line'>
</span><span class='line'>// Step 6:手动解决冲突，然后运行 git add 将把它们标记为已解决<span class="o">(</span>resolved<span class="o">)</span>,
</span><span class='line'>如果觉得满意了,并且确认所有冲突都已解决,也就是进入了缓存区,就可以用 git commit 来完成这次合并提交。
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>git commit -am <span class="s1">&#39;removed invalid default value&#39;</span>
</span><span class='line'><span class="o">[</span>master 738ee87<span class="o">]</span> removed invalid default value
</span><span class='line'>1 files changed, 1 insertions<span class="o">(</span>+<span class="o">)</span>, 1 deletions<span class="o">(</span>-<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>// Step 7:将完成的代码推送到服务器的代码仓库中
</span><span class='line'><span class="nv">$ </span>git push origin master
</span><span class='line'>...
</span><span class='line'>To jessica@githost:simplegit.git
</span><span class='line'>1edee6b..fbff5bc master -&gt; master
</span></code></pre></td></tr></table></div></figure>


<h3>Tips</h3>

<h4>如何将另一分支上的某文件复制到当前分支上来？</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$git</span> checkout currentBranch
</span><span class='line'><span class="nv">$git</span> checkout anotherBranch -- filenameYourWantedCopy
</span></code></pre></td></tr></table></div></figure>


<h4>如何不再控制已经提交到仓库的文件？</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$git</span> rm --cached filenameYourDontWantTracked
</span></code></pre></td></tr></table></div></figure>


<h4>如何将目录覆盖下一级的同名目录？</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>// 背景
</span><span class='line'>|-A
</span><span class='line'>|-B
</span><span class='line'>  |-A
</span><span class='line'>
</span><span class='line'>// 目标
</span><span class='line'>|-B
</span><span class='line'>  |-A
</span><span class='line'>
</span><span class='line'>// 解决办法
</span><span class='line'>1. rsync -a A/ B/A
</span><span class='line'>2. <span class="o">(</span><span class="nb">cd </span>A <span class="o">&amp;&amp;</span> tar c .<span class="o">)</span> | <span class="o">(</span><span class="nb">cd </span>B/A <span class="o">&amp;&amp;</span> tar xf -<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>不再跟踪已经删除的文件</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git add --update
</span></code></pre></td></tr></table></div></figure>


<h4>insufficient permission for adding an object to repository database ./objects</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ssh me@myserver
</span><span class='line'><span class="nb">cd </span>repository.git
</span><span class='line'>
</span><span class='line'>sudo chmod -R g+w *
</span><span class='line'>
</span><span class='line'>git config core.sharedRepository <span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Reference:<a href="http://stackoverflow.com/questions/1918524/error-pushing-to-github-insufficient-permission-for-adding-an-object-to-reposi">http://stackoverflow.com/questions/1918524/error-pushing-to-github-insufficient-permission-for-adding-an-object-to-reposi</a></p>

<h4>Reference</h4>

<p><a href="http://git-scm.com/book/zh/v1">Pro Git</a></p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-11-05T10:13:13+08:00" pubdate data-updated="true">Nov 5<span>th</span>, 2014</time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/archives/'>Archives</a>

</div>


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
    
    
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style_24x24">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1395286292635329" charset="utf-8"></script>
<!-- JiaThis Button END -->

<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js"></script>
<!-- UY END -->

    
    
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    Sheldon


- 署名 - 非商业 - 非衍生 - Powered by Octopress.</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-52345084-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
