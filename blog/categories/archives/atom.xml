<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: archives | Hello World]]></title>
  <link href="http://DamianSheldon.github.io/blog/categories/archives/atom.xml" rel="self"/>
  <link href="http://DamianSheldon.github.io/"/>
  <updated>2021-03-18T12:21:41+08:00</updated>
  <id>http://DamianSheldon.github.io/</id>
  <author>
    <name><![CDATA[Sheldon]]></name>
    <email><![CDATA[dongmeilianghy@sina.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[UI 设计与屏幕适配]]></title>
    <link href="http://DamianSheldon.github.io/blog/ui-design-and-screen-adaptation.html"/>
    <updated>2021-03-17T15:12:26+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/ui-design-and-screen-adaptation</id>
    <content type="html"><![CDATA[<p>目前移动设备的尺寸很多，所以前端 (iOS, Android, Web, 小程序等)开发需要适配多种尺寸屏幕。在适配时我们可能会有困惑，设计稿通常是 px 来表示尺寸，设备的分辨率也是以 px 来表示，它们之间是一样的吗？还是存在什么关系？iOS 开发者用 point 来表示视图的尺寸； Android 开发者用 dp 来表示视图尺寸； Web 开发者用 px 来表示尺寸？它们和设计稿的 px 是什么关系？设计师应该以什么基准尺寸来设计会有利于屏幕适配？应该输出几套切图？除了切图，设计师还可以做些什么来配合开发者做屏幕适配？要搞清楚这些问题，我们需要翻翻历史了。</p>

<p>Tim Chien 和 Robert Nyman 的这篇 <a href="https://hacks.mozilla.org/2013/09/css-length-explained/">CSS Length Explained</a> 帮了我的大忙，本文就是基于它而写成。</p>

<h2>英寸</h2>

<p>我们经常是用英寸为度量单位来表示手机屏幕尺寸，一英寸相当于2.54厘米或0.0254米。</p>

<h2>设备像素(device pixel)</h2>

<p>计算机屏幕显示事物的单位是像素。显示屏上的单个物理 &ldquo;光点"，能够独立于它的邻居显示出完整的颜色，被称为像素（图片元素）。我们把屏幕上的物理像素称为 "设备像素"。</p>

<h2>DPI, PPI</h2>

<p>DPI 是 dots per inch 的英文缩写，即每英寸点数； PPI 是 pixels per inch 的缩写，即每英寸像素。 它们都用来表示显示像素密度 (Display pixel density)。</p>

<p>计算机屏幕是由大量发光二极管整齐排列构成的集成电路，由于屏幕制造商工艺水平差异，每英寸集成电路上排列的二极管的数量会不一样，屏幕出厂时我们可以从厂商那里得知屏幕的 PPI。</p>

<p>于是我们可以知道:</p>

<pre><code>width or height of one device pixel = 1 / device's DPI  
</code></pre>

<p>例如 MacBook Air(2011) 的 DPI 为 125 ， 所以：</p>

<pre><code>(width or height of one device pixel) = 1/125 inch = 0.008 inch = 0.02032 cm
</code></pre>

<!--more-->


<h2>The CSS pixel (px)</h2>

<p>CSS像素的尺寸大致可以看成是人的肉眼能够舒适地看到的尺寸，不要太小，这样你就得眯着眼睛，也不要大到让你看到像素化。"看得很舒服 &ldquo; 的定义比较笼统，<a href="http://www.w3.org/TR/CSS2/syndata.html%23length-units">W3C CSS规范</a>中给我们一个推荐的参考。</p>

<blockquote><p>The reference pixel is the visual angle of one pixel on a device with a pixel density of 96 DPI and a distance from the reader of an arm’s length.</p></blockquote>

<h2>The viewing distance</h2>

<p>如前所述，观看距离因人而异，因设备而异，这就是为什么我们必须将设备按外形因素分类的原因。推荐的参考观看距离(&ldquo;一臂之长&rdquo;)和参考像素密度(&ldquo;96 DPI&rdquo;)其实是历史数据。</p>

<p>对于21世纪的日常设备，我们有不同的参考建议:</p>

<table>
<thead>
<tr>
<th> Device </th>
<th> Baseline pixel density </th>
<th> Width/height of one CSS pixel </th>
<th> Viewing distance</th>
</tr>
</thead>
<tbody>
<tr>
<td> A 20th century PC with CRT display </td>
<td> 96 DPI </td>
<td> ~0.2646 mm (1/96in) </td>
<td> 28 in (71.12cm) </td>
</tr>
<tr>
<td> Modern laptop with LCD </td>
<td> 125 DPI </td>
<td> 0.2032 mm (1/125in) </td>
<td> 21.5 in (54.61cm)</td>
</tr>
<tr>
<td> Smartphones/Tablets </td>
<td> 160 DPI </td>
<td> ~0.159mm (1/160 in) </td>
<td> 16.8in (42.672cm) </td>
</tr>
</tbody>
</table>


<p>因此，我们在 CSS 的世界里建立了一个基本的事实：一个 CSS 像素会以不同的物理尺寸显示，但它总是以正确的尺寸显示，让浏览者感到舒适。</p>

<h2>Device pixel ratio (DPPX)</h2>

<p>随着我们步入未来，现在很多智能手机在出厂时都采用了高密度的显示屏。为了保证 CSS 像素在每一个访问网络的设备(即一切有屏幕和网络连接的设备)上的尺寸一致，设备制造商不得不将多个设备像素映射到一个 CSS 像素上，以弥补它相对更大的物理尺寸。CSS 像素相对于设备像素的尺寸比就是设备像素比(DPPX)。</p>

<p>我们以 iPhone 4 为最著名的例子。它配备了一块 326 DPI 的显示屏。根据我们上面的表格，作为一款智能手机，它的典型观看距离是 16.8 英寸，它的基准像素密度是 160DPI。为了创建一个 CSS 像素，苹果选择将设备像素比设置为 2，这就等于让 iOS Safari 显示网页的方式和 163 DPI 手机上一样。</p>

<p>在我们继续之前，先回头看看上面的数字。其实我们可以做得更好，不把设备像素比设置为2，而是设置为<code>326/160=2.0375</code>，让一个 CSS 像素与参考尺寸相比完全一样。不幸的是，这样的比例会导致一个意想不到的结果：由于每个 CSS 像素并不是由整个设备像素来显示的，所以浏览器不得不对所有的位图图像、边框等进行反锯齿，因为它们几乎总是被当作整个 CSS 像素来显示。浏览器很难利用2.0375个设备像素来绘制你的1个CSS像素宽的边框：如果比例是简单的2，那就容易多了。</p>

<p>顺带一提，163 DPI恰好是上一代 iPhone 的像素密度，所以网页的工作方式也是一样的，不需要开发者对自己的网站进行任何特殊的"升级"。</p>

<p>设备制造商通常选择1.5，或2，或其他整数作为 DPPX 值。偶尔，有些设备决定不这么玩了，发货时使用1.325 DPPX这样的值；作为开发者，我们也许应该忽略这些设备。</p>

<p>现在我们就比较清楚 CSS pixel 和 device pixel 的关系了。接下来我们看下 iOS 的 point 和 device pixel 的关系。</p>

<h2>point</h2>

<blockquote><p>The coordinate system iOS uses to place content onscreen is based on measurements in points, which map to pixels in the display. A standard-resolution display has a <code>1:1</code> pixel density (or <code>@1x</code>), where one pixel is equal to one point. High-resolution displays have a higher pixel density, offering a scale factor of 2.0 or 3.0 (referred to as <code>@2x</code> and <code>@3x</code>). As a result, high-resolution displays demand images with more pixels.</p></blockquote>

<p>从 Apple 这段描述可知， scale factor (<code>@1x</code>, <code>@2x</code> 和 <code>@3x</code>) 就是我们上面据说的设备像素比（DPPX)。point 和 css pixel 是对应的。</p>

<h2>dp</h2>

<p>那 dp 和 device pixel 又是什么关系呢？</p>

<blockquote><p>To preserve the visible size of your UI on screens with different densities, you must design your UI using density-independent pixels (dp) as your unit of measurement. One dp is a virtual pixel unit that&rsquo;s roughly equal to one pixel on a medium-density screen (160dpi; the &ldquo;baseline&rdquo; density). Android translates this value to the appropriate number of real pixels for each other density.</p></blockquote>

<p>Google 这段描述更加直接，dp 是一个虚拟的像素单位，大致相当于中密度屏幕上的一个像素(160dpi;&ldquo;基线"密度)，所以 dp 和 css pixel 也是对应的。而 xhdpi, xxhdpi 和 xxxhdpi 是表示设备像素比(DPPX)2、3 和 4。</p>

<p>现在我们还剩下设计稿的 px。我们回忆一下在前端开发时，如果我们不指定图片尺寸而直接去显示设计师的切图，这时图片是有一个固有尺寸的，在设备像素比为1的设备上，这个固有尺寸就是图片的尺寸，而在设备像素比为2上尺寸是图片的尺寸除以2，所以设计稿的 px是对应设备像素(device pixel)的，这也是为什么我们需要提供多套图片来做适配。假设我们不提供多套图片，现在我们有一个 <code>100 x 100 css pixel</code>的图片， 在设备像素比为3的设备上也会去加载 <code>100 x 100 device pixel</code> 尺寸的资源图，按上面的分析，实际它应该加载 <code>300 x 300 device pixel</code> 尺寸的资源图，那么相当于资源图上一个像素点会对应显示三个设备像素点，这样可能会出现模糊或锯齿的情况。</p>

<p>理清了各平台尺寸单位的关系以及它们与设备像素的关系后，我们来看下设备尺寸。</p>

<h2>设备尺寸</h2>

<p>我们先看下 iOS 设备尺寸分布:</p>

<table>
<thead>
<tr>
<th> 型号 </th>
<th> points </th>
<th> 物理像素 </th>
<th style="text-align:center;"> 设备像素比(DPPX) </th>
</tr>
</thead>
<tbody>
<tr>
<td> 2G,3G,3GS </td>
<td> 320 x 480 </td>
<td> 320 x 480</td>
<td style="text-align:center;"> 1 </td>
</tr>
<tr>
<td> 4,4S </td>
<td> 320 x 480 </td>
<td> 640 x 960 </td>
<td style="text-align:center;"> 2 </td>
</tr>
<tr>
<td> 5,5C,5S,SE </td>
<td> 320 x 568 </td>
<td> 640 x 1136 </td>
<td style="text-align:center;"> 2 </td>
</tr>
<tr>
<td> 6,6S,7,8,SE2</td>
<td> 375 x 667 </td>
<td> 750 x 1334 </td>
<td style="text-align:center;"> 2 </td>
</tr>
<tr>
<td> 6+,6S+,7+,8+ </td>
<td> 414 x 736 </td>
<td> 1080 x 1920 </td>
<td style="text-align:center;"> 3 </td>
</tr>
<tr>
<td> 11Pro,X,Xs </td>
<td> 375 x 812 </td>
<td> 1125 x 2436 </td>
<td style="text-align:center;"> 3 </td>
</tr>
<tr>
<td> 11, Xr </td>
<td> 414 x 896 </td>
<td> 828 x 1792 </td>
<td style="text-align:center;"> 2 </td>
</tr>
<tr>
<td> 11Pro Max,Xs Max </td>
<td> 414 x 896 </td>
<td> 1242 x 2688 </td>
<td style="text-align:center;"> 3 </td>
</tr>
</tbody>
</table>


<p>对于 iOS 来说，现在的主流设备应该是从 <code>6,6S,7,8,SE2</code> 开始，对应的设备像素是<code>750 x 1334 px</code>。</p>

<p>再来看下 android 这边， Google 有一个 <a href="https://developer.android.com/about/dashboards/index.html#Screens">Screen sizes and densities</a> 统计表，本文写作时查询的结果如下:</p>

<table>
<thead>
<tr>
<th> </th>
<th> ldpi </th>
<th> mdpi </th>
<th> tvdpi </th>
<th> hdpi </th>
<th> xhdpi </th>
<th> xxhdpi </th>
<th> Total </th>
</tr>
</thead>
<tbody>
<tr>
<td> Small </td>
<td> 0.1% </td>
<td>  </td>
<td>  </td>
<td> </td>
<td> 0.1% </td>
<td>  </td>
<td> 0.2% </td>
</tr>
<tr>
<td> Normal </td>
<td>  </td>
<td> 0.3% </td>
<td> 0.3% </td>
<td> 14.8% </td>
<td> 41.3% </td>
<td> 26.1% </td>
<td> 82.8% </td>
</tr>
<tr>
<td> Large </td>
<td>  </td>
<td> 1.7% </td>
<td> 2.2% </td>
<td> 0.8% </td>
<td> 3.2% </td>
<td> 2.0% </td>
<td> 9.9%  </td>
</tr>
<tr>
<td> Xlarge </td>
<td>  </td>
<td> 4.2% </td>
<td> 0.2% </td>
<td> 2.3% </td>
<td> 0.4% </td>
<td>  </td>
<td> 7.1% </td>
</tr>
<tr>
<td> Total </td>
<td> 0.1% </td>
<td> 6.2% </td>
<td> 2.7% </td>
<td>  17.9% </td>
<td> 45.0% </td>
<td> 28.1% </td>
<td>  </td>
</tr>
</tbody>
</table>


<p><a href="https://developer.android.google.cn/guide/topics/resources/providing-resources#ScreenSizeQualifier">Small,Normal,Large 和 Xlarge</a> 是屏幕的尺寸分类，具体含义如下:</p>

<blockquote><ul>
<li><p>small: Screens that are of similar size to a low-density QVGA screen. The minimum layout size for a small screen is approximately 320x426 dp units. Examples are QVGA low-density and VGA high density.</p></li>
<li><p>normal: Screens that are of similar size to a medium-density HVGA screen. The minimum layout size for a normal screen is approximately 320x470 dp units. Examples of such screens a WQVGA low-density, HVGA medium-density, WVGA high-density.</p></li>
<li><p>large: Screens that are of similar size to a medium-density VGA screen. The minimum layout size for a large screen is approximately 480x640 dp units. Examples are VGA and WVGA medium-density screens.</p></li>
<li><p>xlarge: Screens that are considerably larger than the traditional medium-density HVGA screen. The minimum layout size for an xlarge screen is approximately 720x960 dp units. In most cases, devices with extra-large screens would be too large to carry in a pocket and would most likely be tablet-style devices. Added in API level 9.</p></li>
</ul>
</blockquote>

<p>从上表的数据可知，目前 android 设备的主流尺寸分布是从 normal 这个分类开始，根据 google 对 normal 的解释，它的大小相当于 medium-density HVGA 屏幕上的 <code>320x470 dp</code>，换算成设备像素就是 <code>640x940 px</code>。</p>

<p>我们知道宽屏比窄屏能显示更多内容，如果我们以宽屏为其准尺寸设计，那么在窄屏上就可能出现控件放不下、文字截断的情况。反过来，如果我们以窄屏为基准设计，那么在宽屏上布局时会容易处理，控件的宽度增加或者间隔增加就可以了。高度和宽度存在同样的问题，所以也应该选高度小的作为基准。设计时扣除固定元素高度之和后分配给可滚动区域，这样方便界面的元素布局能够动态响应，开发更好做屏幕适配。</p>

<p>所以选择基准尺寸和我们想支持的设备紧密相关，这需要基于多方面的因素考虑。 例如，如果我们希望支持尽可能多的设备，就越有可能获取更多用户，但开发的兼容工作量就相应增加，很多新特性就可能不适合作为应用的主要功能，而只适合作为增强功能。通常可以考虑覆盖 90% 以上，团队资金和人员比较充足的话可以考虑覆盖 95%，98% 甚至更多。</p>

<p>以覆盖 90% 以上为例，如果我们同时支持 iOS 和 android，或只支持 android 时，应该选 <code>640x940 px</code>作为基准尺寸，而如果只支持 iOS ， 我们应该选 <code>750 x 1334 px</code> 作为基准尺寸。</p>

<p>iOS 的设备像素比主要分布在2和3，而 android 这边设备像素比主要分布在 1.5(hdpi), 2(xhdpi)和 3(xxhdpi)，所以 iOS 需要输出<code>@2x</code> 和 <code>@3x</code> 两套切图； android 需要输出 hdpi, xhdpi 和 xxhdpi 三套切图。</p>

<h2>总结</h2>

<p>现在我们知道，设计基准尺寸的选择以及切图的输出是和我们想支持的设备紧密相关，写作本文时：</p>

<h3>基准尺寸</h3>

<ul>
<li>仅支持 iOS ， 应该选 <code>750 x 1334 px</code> 作为基准尺寸</li>
<li>仅支持 android 时，应该选 <code>640x940 px</code> 作为基准尺寸</li>
<li>支持 iOS 和 android，应该选 <code>640x940 px</code> 作为基准尺寸</li>
</ul>


<h3>切图</h3>

<ul>
<li>支持 iOS 需要输出<code>@2x</code> 和 <code>@3x</code> 两套切图</li>
<li>支持 android 需要输出 hdpi, xhdpi 和 xxhdpi 三套切图</li>
</ul>


<p>我们需要需要注意，随着设备的更新换代，我们的基准尺寸和切图会发生变化，就像以前我们可能需要为 android 提供 mdpi 的切图。</p>

<p>另外想说一下，设计师在设计之初就要把屏幕适配这事放在心上，将界面的元素看成水流一样，尽量让它们能自由流动，这样开发者就能更好地也更容易地做屏幕适配。Apple 在屏幕适配这块提出了 auto layout 的解决方案，这是一个设计师视角的解决方案，也是我们日常的生活中的视角，用界面元素的之间的约束来表达布局，推荐设计师用约束这种方式去做设计并最终输出。可以看到 google 实际上也很认可 auto layout 用约束来布局的想法，在新版本的 android 开发中默认的根布局容器就是 ConstraintLayout，它就是用约束来表达布局。最后我们再看 web 开发布局这边，css 布局的核心就是流，为支持屏幕适配，目前的主流方案是响应式布局，而这种布局的核心我认为仍然是约束。可以看到在屏幕适配这块，各平台最终的想法其实是一样的。</p>

<h1>Reference</h1>

<ul>
<li><a href="https://hacks.mozilla.org/2013/09/css-length-explained/">CSS Length Explained</a></li>
<li><a href="https://developer.apple.com/design/human-interface-guidelines/ios/icons-and-images/image-size-and-resolution/">Image Size and Resolution</a></li>
<li><a href="https://developer.android.google.cn/training/multiscreen/screendensities">Support different pixel densities</a></li>
<li><a href="https://developer.android.google.cn/guide/topics/resources/providing-resources#ScreenSizeQualifier">ScreenSizeQualifier</a></li>
<li><a href="https://developer.android.google.cn/training/multiscreen/screensizes">Support different screen sizes</a></li>
<li><a href="https://developer.android.com/about/dashboards/index.html#Screens">Screen sizes and densities</a></li>
<li><a href="https://www.paintcodeapp.com/news/ultimate-guide-to-iphone-resolutions">The Ultimate Guide To iPhone Resolutions</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MySQL 使用笔记(二)]]></title>
    <link href="http://DamianSheldon.github.io/blog/mysql-usage-notes-part-2.html"/>
    <updated>2020-12-18T08:46:08+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/mysql-usage-notes-part-2</id>
    <content type="html"><![CDATA[<h3>1.How do I see all foreign keys to a table or column?</h3>

<p>A:For a Table:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SELECT
</span><span class='line'>  TABLE_NAME,COLUMN_NAME,CONSTRAINT_NAME, REFERENCED_TABLE_NAME,REFERENCED_COLUMN_NAME
</span><span class='line'>FROM
</span><span class='line'>  INFORMATION_SCHEMA.KEY_COLUMN_USAGE
</span><span class='line'>WHERE
</span><span class='line'>  REFERENCED_TABLE_SCHEMA = &lsquo;&lt;database>&rsquo; AND
</span><span class='line'>  REFERENCED_TABLE_NAME = &lsquo;&lt;table>&rsquo;;</span></code></pre></td></tr></table></div></figure></p>

<p>For a Column:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SELECT
</span><span class='line'>  TABLE_NAME,COLUMN_NAME,CONSTRAINT_NAME, REFERENCED_TABLE_NAME,REFERENCED_COLUMN_NAME
</span><span class='line'>FROM
</span><span class='line'>  INFORMATION_SCHEMA.KEY_COLUMN_USAGE
</span><span class='line'>WHERE
</span><span class='line'>  REFERENCED_TABLE_SCHEMA = &lsquo;&lt;database>&rsquo; AND
</span><span class='line'>  REFERENCED_TABLE_NAME = &lsquo;&lt;table>&rsquo; AND
</span><span class='line'>  REFERENCED_COLUMN_NAME = &lsquo;&lt;column>&rsquo;;</span></code></pre></td></tr></table></div></figure></p>

<p>Reference:</p>

<p><a href="https://stackoverflow.com/questions/201621/how-do-i-see-all-foreign-keys-to-a-table-or-column">How do I see all foreign keys to a table or column?</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何发布自己的 artifacts 到 maven 中央仓库]]></title>
    <link href="http://DamianSheldon.github.io/blog/how-to-publish-your-artifacts-to-maven-central.html"/>
    <updated>2020-10-28T09:16:37+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/how-to-publish-your-artifacts-to-maven-central</id>
    <content type="html"><![CDATA[<p>当我们越来越熟悉 Java 开发，可能也想发布自己的 artifacts 到 maven 中央仓库，那么该如何做呢？</p>

<blockquote><p>The easiest way to upload another project is to use the <a href="http://central.sonatype.org/pages/ossrh-guide.html">Open Source Software Repository Hosting (OSSRH)</a>, which is an approved repository provided by Sonatype for any OSS Project that want to get their artifacts into the Central Repository.</p></blockquote>

<p>从 maven 的官方文档可知是使用 <a href="http://central.sonatype.org/pages/ossrh-guide.html">Open Source Software Repository Hosting (OSSRH)</a>, 于是我们可以参考她的指南。</p>

<p>这份指南勾勒了发布工作的主要流程，分别是：</p>

<ol>
<li>Create a ticket with Sonatype</li>
<li>Review Requirements</li>
<li>Deployment</li>
<li>Releasing to Central</li>
</ol>


<h3>创建 Sonatype 工单</h3>

<p>Sonatype 使用 JIRA 管理请求，所以我们要创建 JIRA 帐号, 然后创建一个新工程工单。</p>

<ol>
<li><a href="https://issues.sonatype.org/secure/Signup!default.jspa">Create your JIRA account</a></li>
<li><a href="https://issues.sonatype.org/secure/CreateIssue.jspa?issuetype=21&amp;pid=10134">Create a New Project ticket</a></li>
</ol>


<h3>复核要求</h3>

<p>为了确保中央仓库库中可用组件的最低质量水平，部署组件必须满足一些要求。这使组件的用户能够从中央仓库中提供的元数据中找到有关组件的所有相关细节。</p>

<p>这些要求是：</p>

<ol>
<li>Supply Javadoc and Sources</li>
<li>Sign Files with GPG/PGP</li>
<li>Sufficient Metadata</li>
</ol>


<!--more-->


<h4>Supply Javadoc and Sources</h4>

<p>我们可以集成 maven 插件来提供 Javadoc 和源文件。</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;plugin>
</span><span class='line'>    &lt;groupId>org.apache.maven.plugins&lt;/groupId>
</span><span class='line'>    &lt;artifactId>maven-source-plugin&lt;/artifactId>
</span><span class='line'>    &lt;version>2.2.1&lt;/version>
</span><span class='line'>    &lt;executions>
</span><span class='line'>        &lt;execution>
</span><span class='line'>            &lt;id>attach-sources&lt;/id>
</span><span class='line'>            &lt;goals>
</span><span class='line'>                &lt;goal>jar-no-fork&lt;/goal>
</span><span class='line'>            &lt;/goals>
</span><span class='line'>        &lt;/execution>
</span><span class='line'>    &lt;/executions>
</span><span class='line'>&lt;/plugin>
</span><span class='line'>&lt;plugin>
</span><span class='line'>    &lt;groupId>org.apache.maven.plugins&lt;/groupId>
</span><span class='line'>    &lt;artifactId>maven-javadoc-plugin&lt;/artifactId>
</span><span class='line'>    &lt;version>2.9.1&lt;/version>
</span><span class='line'>    &lt;executions>
</span><span class='line'>        &lt;execution>
</span><span class='line'>            &lt;id>attach-javadocs&lt;/id>
</span><span class='line'>            &lt;goals>
</span><span class='line'>                &lt;goal>jar&lt;/goal>
</span><span class='line'>            &lt;/goals>
</span><span class='line'>        &lt;/execution>
</span><span class='line'>    &lt;/executions>
</span><span class='line'>&lt;/plugin></span></code></pre></td></tr></table></div></figure></p>

<h4>Sign Files with GPG/PGP</h4>

<p>我们需要用 GPG/PGP 对文件签名，以 macOS 为例：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>1. Install GPG&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>brew install gpg&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>2. Generate the key pair&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>gpg &ndash;full-gen-key&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h3>3.Publish the GPG key pair and distribute your key to GPG servers&lt;/h3>
</span><span class='line'>
</span><span class='line'>&lt;p>gpg &ndash;keyserver hkps.pool.sks-keyservers.net  &ndash;send-keys your_key_id&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>

<p>生成 GPG 公私钥对并发布到 GPG 服务器后，我们还需要将 GPG 提供给 maven, 这是通过 maven settings。</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>~/.m2/settings.xml&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>&lt;settings>
</span><span class='line'>  &lt;profiles>
</span><span class='line'>    &lt;profile>
</span><span class='line'>      &lt;id>ossrh&lt;/id>
</span><span class='line'>      &lt;activation>
</span><span class='line'>        &lt;activeByDefault>true&lt;/activeByDefault>
</span><span class='line'>      &lt;/activation>
</span><span class='line'>      &lt;properties>
</span><span class='line'>        &lt;gpg.passphrase>the_pass_phrase&lt;/gpg.passphrase>
</span><span class='line'>      &lt;/properties>
</span><span class='line'>    &lt;/profile>
</span><span class='line'>  &lt;/profiles>
</span><span class='line'>&lt;/settings></span></code></pre></td></tr></table></div></figure></p>

<p>macOS 上我还遇到了 gpg: signing failed: Inappropriate ioctl for device 这个错误，通过在 <code>~/.bash_profile</code> 中加入如下配置解决了:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>GPG_TTY=$(tty)
</span><span class='line'>export GPG_TTY</span></code></pre></td></tr></table></div></figure></p>

<h4>Sufficient Metadata</h4>

<p>元数据信息要包括：</p>

<ul>
<li>Correct Coordinates</li>
<li>Project Name, Description and URL</li>
<li>License Information</li>
<li>Developer Information</li>
<li>SCM Information</li>
</ul>


<p>对于 Correct Coordinates， 我这里是使用 github 托管代码，于是我们可以按照 maven 官方文档的建议:</p>

<blockquote><p>My project is hosted at a project hosting service like SourceForge or Github, what should I use as groupId?
If your project name is foo at SourceForge, you can use net.sf.foo. If your username is bar on Github, you can use com.github.bar. You can also use another reversed domain name you control. The group ID does not have to reflect the project host.</p></blockquote>

<h3>Deployment</h3>

<p>至此，准备工作就完成了，接下来可以进入部署环节了。先还是要做些相关配置，主要是：</p>

<ul>
<li>Distribution Management and Authentication</li>
<li>Using a Profile</li>
</ul>


<h4>Distribution Management and Authentication</h4>

<p>为了配置 Maven，使其能够通过 Nexus Staging Maven 插件部署到 OSSRH 的 Nexus Repository Manager上，你必须进行如下配置：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;distributionManagement>
</span><span class='line'>  &lt;snapshotRepository>
</span><span class='line'>    &lt;id>ossrh&lt;/id>
</span><span class='line'>    &lt;url>&lt;a href="https://oss.sonatype.org/content/repositories/snapshots">https://oss.sonatype.org/content/repositories/snapshots&lt;/a>&lt;/url>
</span><span class='line'>  &lt;/snapshotRepository>
</span><span class='line'>&lt;/distributionManagement>
</span><span class='line'>&lt;build>
</span><span class='line'>  &lt;plugins>
</span><span class='line'>    &lt;plugin>
</span><span class='line'>      &lt;groupId>org.sonatype.plugins&lt;/groupId>
</span><span class='line'>      &lt;artifactId>nexus-staging-maven-plugin&lt;/artifactId>
</span><span class='line'>      &lt;version>1.6.7&lt;/version>
</span><span class='line'>      &lt;extensions>true&lt;/extensions>
</span><span class='line'>      &lt;configuration>
</span><span class='line'>        &lt;serverId>ossrh&lt;/serverId>
</span><span class='line'>        &lt;nexusUrl>&lt;a href="https://oss.sonatype.org/">https://oss.sonatype.org/&lt;/a>&lt;/nexusUrl>
</span><span class='line'>        &lt;autoReleaseAfterClose>true&lt;/autoReleaseAfterClose>
</span><span class='line'>      &lt;/configuration>
</span><span class='line'>    &lt;/plugin>
</span><span class='line'>    &hellip;
</span><span class='line'>  &lt;/plugins>
</span><span class='line'>&lt;/build></span></code></pre></td></tr></table></div></figure></p>

<p>另外，如果你使用 Maven 部署插件，这是默认行为，你需要添加一个完整的distributionManagement部分。</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;distributionManagement>
</span><span class='line'>  &lt;snapshotRepository>
</span><span class='line'>    &lt;id>ossrh&lt;/id>
</span><span class='line'>    &lt;url>&lt;a href="https://oss.sonatype.org/content/repositories/snapshots">https://oss.sonatype.org/content/repositories/snapshots&lt;/a>&lt;/url>
</span><span class='line'>  &lt;/snapshotRepository>
</span><span class='line'>  &lt;repository>
</span><span class='line'>    &lt;id>ossrh&lt;/id>
</span><span class='line'>    &lt;url>&lt;a href="https://oss.sonatype.org/service/local/staging/deploy/maven2/">https://oss.sonatype.org/service/local/staging/deploy/maven2/&lt;/a>&lt;/url>
</span><span class='line'>  &lt;/repository>
</span><span class='line'>&lt;/distributionManagement></span></code></pre></td></tr></table></div></figure></p>

<p>上述配置将从你的Maven settings.xml文件中获取用户账户的详细信息来部署到OSSRH。认证的最小设置是：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;settings>
</span><span class='line'>  &lt;servers>
</span><span class='line'>    &lt;server>
</span><span class='line'>      &lt;id>ossrh&lt;/id>
</span><span class='line'>      &lt;username>your-jira-id&lt;/username>
</span><span class='line'>      &lt;password>&lt;![CDATA[your-jira-pwd]]&gt;&lt;/password>
</span><span class='line'>    &lt;/server>
</span><span class='line'>  &lt;/servers>
</span><span class='line'>&lt;/settings></span></code></pre></td></tr></table></div></figure></p>

<h4>Using a Profile</h4>

<p>由于生成javadoc和源代码jars以及使用GPG签署组件是一个相当耗时的过程，这些执行通常从正常的构建配置中分离出来，并转移到一个配置文件中。然后，当通过激活配置文件进行部署时，该配置文件又会被使用。</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;profiles>
</span><span class='line'>  &lt;profile>
</span><span class='line'>    &lt;id>release&lt;/id>
</span><span class='line'>    &lt;build>
</span><span class='line'>      &hellip;
</span><span class='line'>      javadoc, source and gpg plugin from above
</span><span class='line'>      &hellip;
</span><span class='line'>    &lt;/build>
</span><span class='line'>  &lt;/profile>
</span><span class='line'>&lt;/profiles></span></code></pre></td></tr></table></div></figure></p>

<p>这些配置做完之后，最终得到的 pom.xml 类似如下：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
</span><span class='line'>    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
</span><span class='line'>    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
</span><span class='line'>    &lt;modelVersion>4.0.0&lt;/modelVersion>
</span><span class='line'>    &lt;groupId>com.github.damiansheldon&lt;/groupId>
</span><span class='line'>    &lt;artifactId>treasure&lt;/artifactId>
</span><span class='line'>    &lt;version>0.0.2&lt;/version>
</span><span class='line'>    &lt;build>
</span><span class='line'>        &lt;sourceDirectory>src&lt;/sourceDirectory>
</span><span class='line'>        &lt;plugins>
</span><span class='line'>            &lt;plugin>
</span><span class='line'>                &lt;artifactId>maven-compiler-plugin&lt;/artifactId>
</span><span class='line'>                &lt;version>3.8.1&lt;/version>
</span><span class='line'>                &lt;configuration>
</span><span class='line'>                    &lt;source>1.8&lt;/source>
</span><span class='line'>                    &lt;target>1.8&lt;/target>
</span><span class='line'>                &lt;/configuration>
</span><span class='line'>            &lt;/plugin>
</span><span class='line'>            &lt;plugin>
</span><span class='line'>                &lt;groupId>org.apache.maven.plugins&lt;/groupId>
</span><span class='line'>                &lt;artifactId>maven-deploy-plugin&lt;/artifactId>
</span><span class='line'>                &lt;version>2.8.2&lt;/version>
</span><span class='line'>            &lt;/plugin>
</span><span class='line'>            &lt;plugin>
</span><span class='line'>                &lt;groupId>org.apache.maven.plugins&lt;/groupId>
</span><span class='line'>                &lt;artifactId>maven-release-plugin&lt;/artifactId>
</span><span class='line'>                &lt;version>2.5.3&lt;/version>
</span><span class='line'>                &lt;configuration>
</span><span class='line'>                    &lt;arguments>-Dgpg.passphrase=${gpg.passphrase}&lt;/arguments>
</span><span class='line'>                    &lt;autoVersionSubmodules>true&lt;/autoVersionSubmodules>
</span><span class='line'>                    &lt;useReleaseProfile>false&lt;/useReleaseProfile>
</span><span class='line'>                    &lt;releaseProfiles>release&lt;/releaseProfiles>
</span><span class='line'>                    &lt;goals>deploy&lt;/goals>
</span><span class='line'>                &lt;/configuration>
</span><span class='line'>            &lt;/plugin>
</span><span class='line'>            &lt;plugin>
</span><span class='line'>                &lt;groupId>org.sonatype.plugins&lt;/groupId>
</span><span class='line'>                &lt;artifactId>nexus-staging-maven-plugin&lt;/artifactId>
</span><span class='line'>                &lt;version>1.6.7&lt;/version>
</span><span class='line'>                &lt;extensions>true&lt;/extensions>
</span><span class='line'>                &lt;configuration>
</span><span class='line'>                    &lt;serverId>ossrh&lt;/serverId>
</span><span class='line'>                    &lt;nexusUrl>&lt;a href="https://oss.sonatype.org/">https://oss.sonatype.org/&lt;/a>&lt;/nexusUrl>
</span><span class='line'>                    &lt;autoReleaseAfterClose>true&lt;/autoReleaseAfterClose>
</span><span class='line'>                &lt;/configuration>
</span><span class='line'>            &lt;/plugin>
</span><span class='line'>        &lt;/plugins>
</span><span class='line'>    &lt;/build>
</span><span class='line'>    &lt;dependencies>
</span><span class='line'>        &lt;dependency>
</span><span class='line'>            &lt;groupId>org.springframework&lt;/groupId>
</span><span class='line'>            &lt;artifactId>spring-jdbc&lt;/artifactId>
</span><span class='line'>            &lt;version>5.2.8.RELEASE&lt;/version>
</span><span class='line'>        &lt;/dependency>
</span><span class='line'>    &lt;/dependencies>
</span><span class='line'>    &lt;distributionManagement>
</span><span class='line'>        &lt;repository>
</span><span class='line'>            &lt;id>ossrh&lt;/id>
</span><span class='line'>            &lt;name>OSSRH Staging Repository&lt;/name>
</span><span class='line'>            &lt;url>&lt;a href="https://oss.sonatype.org/service/local/staging/deploy/maven2">https://oss.sonatype.org/service/local/staging/deploy/maven2&lt;/a>&lt;/url>
</span><span class='line'>        &lt;/repository>
</span><span class='line'>        &lt;snapshotRepository>
</span><span class='line'>            &lt;id>ossrh&lt;/id>
</span><span class='line'>            &lt;name>OSSRH Snapshots&lt;/name>
</span><span class='line'>            &lt;url>&lt;a href="https://oss.sonatype.org/content/repositories/snapshots">https://oss.sonatype.org/content/repositories/snapshots&lt;/a>&lt;/url>
</span><span class='line'>        &lt;/snapshotRepository>
</span><span class='line'>    &lt;/distributionManagement>
</span><span class='line'>    &lt;scm>
</span><span class='line'>        &lt;connection>scm:git:&lt;a href="https://github.com/DamianSheldon/Treasure.git">https://github.com/DamianSheldon/Treasure.git&lt;/a>&lt;/connection>
</span><span class='line'>        &lt;developerConnection>scm:git:&lt;a href="https://github.com/DamianSheldon/Treasure.git">https://github.com/DamianSheldon/Treasure.git&lt;/a>&lt;/developerConnection>
</span><span class='line'>        &lt;tag>HEAD&lt;/tag>
</span><span class='line'>        &lt;url>&lt;a href="https://github.com/DamianSheldon/Treasure">https://github.com/DamianSheldon/Treasure&lt;/a>&lt;/url>
</span><span class='line'>    &lt;/scm>
</span><span class='line'>    &lt;profiles>
</span><span class='line'>        &lt;profile>
</span><span class='line'>            &lt;id>release&lt;/id>
</span><span class='line'>            &lt;build>
</span><span class='line'>                &lt;plugins>
</span><span class='line'>                    &lt;plugin>
</span><span class='line'>                        &lt;groupId>org.apache.maven.plugins&lt;/groupId>
</span><span class='line'>                        &lt;artifactId>maven-source-plugin&lt;/artifactId>
</span><span class='line'>                        &lt;version>2.2.1&lt;/version>
</span><span class='line'>                        &lt;executions>
</span><span class='line'>                            &lt;execution>
</span><span class='line'>                                &lt;id>attach-sources&lt;/id>
</span><span class='line'>                                &lt;goals>
</span><span class='line'>                                    &lt;goal>jar-no-fork&lt;/goal>
</span><span class='line'>                                &lt;/goals>
</span><span class='line'>                            &lt;/execution>
</span><span class='line'>                        &lt;/executions>
</span><span class='line'>                    &lt;/plugin>
</span><span class='line'>                    &lt;plugin>
</span><span class='line'>                        &lt;groupId>org.apache.maven.plugins&lt;/groupId>
</span><span class='line'>                        &lt;artifactId>maven-javadoc-plugin&lt;/artifactId>
</span><span class='line'>                        &lt;version>2.9.1&lt;/version>
</span><span class='line'>                        &lt;executions>
</span><span class='line'>                            &lt;execution>
</span><span class='line'>                                &lt;id>attach-javadocs&lt;/id>
</span><span class='line'>                                &lt;goals>
</span><span class='line'>                                    &lt;goal>jar&lt;/goal>
</span><span class='line'>                                &lt;/goals>
</span><span class='line'>                            &lt;/execution>
</span><span class='line'>                        &lt;/executions>
</span><span class='line'>                    &lt;/plugin>
</span><span class='line'>                    &lt;plugin>
</span><span class='line'>                        &lt;groupId>org.apache.maven.plugins&lt;/groupId>
</span><span class='line'>                        &lt;artifactId>maven-gpg-plugin&lt;/artifactId>
</span><span class='line'>                        &lt;version>1.5&lt;/version>
</span><span class='line'>                        &lt;executions>
</span><span class='line'>                            &lt;execution>
</span><span class='line'>                                &lt;id>sign-artifacts&lt;/id>
</span><span class='line'>                                &lt;phase>verify&lt;/phase>
</span><span class='line'>                                &lt;goals>
</span><span class='line'>                                    &lt;goal>sign&lt;/goal>
</span><span class='line'>                                &lt;/goals>
</span><span class='line'>                            &lt;/execution>
</span><span class='line'>                        &lt;/executions>
</span><span class='line'>                    &lt;/plugin>
</span><span class='line'>                &lt;/plugins>
</span><span class='line'>            &lt;/build>
</span><span class='line'>        &lt;/profile>
</span><span class='line'>    &lt;/profiles>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>&lt;!-- More Project Information --&gt;
</span><span class='line'>&lt;name&gt;Treasure&lt;/name&gt;
</span><span class='line'>&lt;description&gt;The treasures I have accumulated in my daily java development. It can help other people face the same problem.&lt;/description&gt;
</span><span class='line'>&lt;url&gt;https://github.com/DamianSheldon/Treasure&lt;/url&gt;
</span><span class='line'>&lt;licenses&gt;
</span><span class='line'>    &lt;license&gt;
</span><span class='line'>        &lt;name&gt;MIT License&lt;/name&gt;
</span><span class='line'>        &lt;url&gt;http://www.opensource.org/licenses/mit-license.php&lt;/url&gt;
</span><span class='line'>        &lt;distribution&gt;repo&lt;/distribution&gt;
</span><span class='line'>    &lt;/license&gt;
</span><span class='line'>&lt;/licenses&gt;
</span><span class='line'>&lt;developers&gt;
</span><span class='line'>    &lt;developer&gt;
</span><span class='line'>        &lt;id&gt;meiliang&lt;/id&gt;
</span><span class='line'>        &lt;name&gt;Meiliang Dong&lt;/name&gt;
</span><span class='line'>        &lt;email&gt;dongmeilianghy@sina.com&lt;/email&gt;
</span><span class='line'>        &lt;url&gt;http://damiansheldon.github.io&lt;/url&gt;
</span><span class='line'>        &lt;roles&gt;
</span><span class='line'>            &lt;role&gt;architect&lt;/role&gt;
</span><span class='line'>            &lt;role&gt;developer&lt;/role&gt;
</span><span class='line'>        &lt;/roles&gt;
</span><span class='line'>        &lt;timezone&gt;Asia/Shanghai&lt;/timezone&gt;
</span><span class='line'>    &lt;/developer&gt;
</span><span class='line'>&lt;/developers&gt;
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>&lt;/project></span></code></pre></td></tr></table></div></figure></p>

<p>做好相关配置之后就可以真正部署了，主要有两种部署方式：</p>

<ul>
<li>Nexus Staging Maven Plugin for Deployment and Release</li>
<li>Performing a Release Deployment with the Maven Release Plugin</li>
</ul>


<p>推荐的方式是使用 Nexus Staging Maven Plugin。</p>

<h4>Nexus Staging Maven Plugin for Deployment and Release</h4>

<p>Performing a Snapshot Deployment</p>

<p>当你的版本以<code>-SNAPSHOT</code>结尾时，会进行快照部署。当执行快照部署时，您不需要满足要求，只需在工程上运行 <code>mvn clean deploy</code></p>

<p>SNAPSHOT版本不同步到中央版本库。如果您希望您的用户使用您的 SNAPSHOT 版本，他们需要将快照库添加到他们的 Nexus Repository Manager、settings.xml 或 pom.xml 中。成功部署的SNAPSHOT版本可以在<code>https://oss.sonatype.org/content/repositories/snapshots/</code>找到。</p>

<p>Performing a Release Deployment</p>

<p>为了执行发布部署，你必须在所有的POM文件中编辑你的版本，以使用发布版本。这意味着它们不能以<code>-SNAPSHOT</code>结尾，此外插件和依赖性声明也不能使用快照版本。这保证了你只能依赖其他发布的组件。理想情况下，它们都在中央仓库中可用。这确保了你的用户可以从中央仓库中检索你的组件以及你的过渡性依赖。</p>

<p>在多模块设置中，可以手动或借助Maven版本插件来更改项目的版本和父级引用。</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mvn versions:set -DnewVersion=1.2.3</span></code></pre></td></tr></table></div></figure></p>

<p>一旦你更新了所有的版本，并确保你的构建没有部署就通过了，你就可以使用发布配置文件进行部署，并使用</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mvn clean deploy -P release</span></code></pre></td></tr></table></div></figure></p>

<h4>Performing a Release Deployment with the Maven Release Plugin</h4>

<p>Maven发布插件可以用来自动完成对Maven POM文件的修改、健康检查、所需的SCM操作和实际部署执行。</p>

<p>Maven发布插件的配置应该包括禁用Maven super POM 中的发布配置文件，因为我们使用的是我们自己的配置文件，并在激活发布配置文件的同时指定部署目标。</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;plugin>
</span><span class='line'>  &lt;groupId>org.apache.maven.plugins&lt;/groupId>
</span><span class='line'>  &lt;artifactId>maven-release-plugin&lt;/artifactId>
</span><span class='line'>  &lt;version>2.5.3&lt;/version>
</span><span class='line'>  &lt;configuration>
</span><span class='line'>    &lt;autoVersionSubmodules>true&lt;/autoVersionSubmodules>
</span><span class='line'>    &lt;useReleaseProfile>false&lt;/useReleaseProfile>
</span><span class='line'>    &lt;releaseProfiles>release&lt;/releaseProfiles>
</span><span class='line'>    &lt;goals>deploy&lt;/goals>
</span><span class='line'>  &lt;/configuration>
</span><span class='line'>&lt;/plugin></span></code></pre></td></tr></table></div></figure></p>

<p>在SCM连接配置正确的情况下，您可以通过以下方式向OSSRH进行发布部署。</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mvn release:clean release:prepare</span></code></pre></td></tr></table></div></figure></p>

<p>回答版本和标签的提示，然后是</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mvn release:perform</span></code></pre></td></tr></table></div></figure></p>

<p>由于使用了Nexus Staging Maven Plugin，并将autoReleaseAfterClose设置为true，这个执行将一次性部署到OSSRH并发布到中央仓库。</p>

<h3>Releasing to Central</h3>

<p>在前面的介绍中，我们提到使用 Nexus Staging Maven Plugin，并将autoReleaseAfterClose设置为true，部署到OSSRH后会发布到中央仓库。我们也可以手动执行 <code>mvn nexus-staging:release
</code> 来发布 staging repository。</p>

<h3>Reference</h3>

<ul>
<li><a href="https://central.sonatype.org/pages/ossrh-guide.html">OSSRH Guide</a></li>
<li><a href="https://central.sonatype.org/pages/requirements.html">Requirements</a></li>
<li><a href="https://central.sonatype.org/pages/apache-maven.html#nexus-staging-maven-plugin-for-deployment-and-release">Deploying to OSSRH with Apache Maven</a></li>
<li><a href="https://dzone.com/articles/publish-your-artifacts-to-maven-central">How to Publish Your Artifacts to Maven Central</a></li>
<li><a href="https://stackoverflow.com/questions/57591432/gpg-signing-failed-inappropriate-ioctl-for-device-on-macos-with-maven">“gpg: signing failed: Inappropriate ioctl for device” on MacOS with Maven</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[一种构建 JavaScript 库的方法]]></title>
    <link href="http://DamianSheldon.github.io/blog/an-approach-to-building-javascript-libraries.html"/>
    <updated>2020-09-23T15:08:06+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/an-approach-to-building-javascript-libraries</id>
    <content type="html"><![CDATA[<p>最近手头有个项目需要构建 JavaScript 库，核心需求是库既能用于传统的多页面，也能用于 Angular 的单页面。目前网络上暂时好像没有这类详细教程，反而是一些理论阐述的文章较多，经过一番研究后，我得到了一个适合自己的方法。</p>

<p>由于我希望库既能用于多页面，也能用于 Angular 单页面，所以需要支持 UMD 和 ES Harmony。由于 Angular 是使用 TypeScript 开发，最好还能提供用于 TypeScript 的声明文件。最原始的想法自然是手动按要求提供各种文件，但这样工作量比较大，也不容易扩展。那么还有什么容易的办法吗？有的，最核心的想法就是库的源码只写一份，然后用工具生成各种模块系统需要文件。具体的做法可能有差异，但理念是一样的。</p>

<p>从我的需求出发，我最终选择用 TypeScript 来写库的源码，基于脱敏的考虑，这里选择 TypeScript 文档中的示例代码来演示。</p>

<p>首先我们建立好库的源码目录结构并配置好源码管理：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>simple-module-example
</span><span class='line'>├── src
</span><span class='line'>│   ├── LettersOnlyValidator.ts
</span><span class='line'>│   ├── Validation.ts
</span><span class='line'>│   ├── ZipCodeValidator.ts
</span><span class='line'>│   └── index.ts</span></code></pre></td></tr></table></div></figure></p>

<p>然后使用 <code>npm init</code> 生成 <code>package.json</code> 文件：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  &ldquo;name&rdquo;: &ldquo;simple-module-example&rdquo;,
</span><span class='line'>  &ldquo;version&rdquo;: &ldquo;1.0.0&rdquo;,
</span><span class='line'>  &ldquo;description&rdquo;: &ldquo;A simple module example.&rdquo;,
</span><span class='line'>  &ldquo;main&rdquo;: &ldquo;index.js&rdquo;,
</span><span class='line'>  &ldquo;directories&rdquo;: {
</span><span class='line'>    &ldquo;test&rdquo;: &ldquo;test&rdquo;
</span><span class='line'>  },
</span><span class='line'>  &ldquo;scripts&rdquo;: {
</span><span class='line'>    &ldquo;test&rdquo;: &ldquo;echo \"Error: no test specified\&rdquo; &amp;&amp; exit 1"
</span><span class='line'>  },
</span><span class='line'>  &ldquo;keywords&rdquo;: [
</span><span class='line'>    &ldquo;module&rdquo;,
</span><span class='line'>    &ldquo;example&rdquo;
</span><span class='line'>  ],
</span><span class='line'>  &ldquo;author&rdquo;: &ldquo;Meiliang Dong&rdquo;,
</span><span class='line'>  &ldquo;license&rdquo;: &ldquo;MIT&rdquo;
</span><span class='line'>}&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>

<!--more-->


<p>其次是按需求编辑好 <code>package.json</code> 文件。这是关键步骤，<code>package.json</code> 的 main 字段通常用于指向 UMD 版本的库；module 字段则用于指向 ES 版本的库。我们还需要配置构建脚本生成对应版本的库，最终的 <code>package.json</code> 文件内容如下：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>    &ldquo;name&rdquo;: &ldquo;simple-module-example&rdquo;,
</span><span class='line'>    &ldquo;version&rdquo;: &ldquo;1.0.0&rdquo;,
</span><span class='line'>    &ldquo;description&rdquo;: &ldquo;A simple module example.&rdquo;,
</span><span class='line'>    &ldquo;main&rdquo;: &ldquo;dist/umd/simple-module-example.js&rdquo;,
</span><span class='line'>    &ldquo;module&rdquo;: &ldquo;dist/esm/index.js&rdquo;,
</span><span class='line'>    &ldquo;browser&rdquo;: &ldquo;dist/umd/simple-module-example.js&rdquo;,
</span><span class='line'>    &ldquo;types&rdquo;: &ldquo;dist/types/index.d.ts&rdquo;,
</span><span class='line'>    &ldquo;files&rdquo;: [
</span><span class='line'>        &ldquo;dist&rdquo;
</span><span class='line'>    ],
</span><span class='line'>    &ldquo;directories&rdquo;: {
</span><span class='line'>        &ldquo;test&rdquo;: &ldquo;test&rdquo;
</span><span class='line'>    },
</span><span class='line'>    &ldquo;scripts&rdquo;: {
</span><span class='line'>        &ldquo;clean&rdquo;: &ldquo;rm -rf ./dist&rdquo;,
</span><span class='line'>        &ldquo;build&rdquo;: &ldquo;npm run clean &amp;&amp; npm run build:es2015 &amp;&amp; npm run build:esm &amp;&amp; npm run build:cjs &amp;&amp; npm run build:umd&rdquo;,
</span><span class='line'>        &ldquo;build:es2015&rdquo;: &ldquo;tsc &ndash;module es2015 &ndash;target es2015 &ndash;outDir dist/es2015&rdquo;,
</span><span class='line'>        &ldquo;build:esm&rdquo;: &ldquo;tsc &ndash;module es2015 &ndash;outDir dist/esm&rdquo;,
</span><span class='line'>        &ldquo;build:umd&rdquo;: &ldquo;rollup dist/esm/index.js &ndash;format umd &ndash;name SimpleModuleExample &ndash;sourcemap &ndash;file dist/umd/simple-module-example.js&rdquo;,
</span><span class='line'>        &ldquo;build:umd:min&rdquo;: &ldquo;cd dist/umd &amp;&amp; uglifyjs &ndash;compress &ndash;mangle &ndash;source-map &ndash;screw-ie8 &ndash;comments &ndash;o simple-module-example.min.js &ndash; simple-module-example.js &amp;&amp; gzip simple-module-example.min.js -c > simple-module-example.min.js.gz&rdquo;
</span><span class='line'>    },
</span><span class='line'>    &ldquo;keywords&rdquo;: [
</span><span class='line'>        &ldquo;module&rdquo;,
</span><span class='line'>        &ldquo;example&rdquo;
</span><span class='line'>    ],
</span><span class='line'>    &ldquo;author&rdquo;: &ldquo;Meiliang Dong&rdquo;,
</span><span class='line'>    &ldquo;license&rdquo;: &ldquo;MIT&rdquo;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure></p>

<p>然后是编写 TypeScript 的配置文件 <code>tsconfig.json</code>， 先使用命令 <code>npm install @tsconfig/recommended --save-dev</code> 安装推荐的配置，之后根据需求定制，最终的内容如下：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>    &ldquo;extends&rdquo;: &ldquo;@tsconfig/recommended/tsconfig.json&rdquo;,
</span><span class='line'>    &ldquo;compilerOptions&rdquo;: {
</span><span class='line'>      &ldquo;outDir&rdquo;: &ldquo;./dist&rdquo;,
</span><span class='line'>      &ldquo;target&rdquo;: &ldquo;es5&rdquo;,
</span><span class='line'>      &ldquo;sourceMap&rdquo;: true,
</span><span class='line'>      &ldquo;declaration&rdquo;: true,
</span><span class='line'>      &ldquo;declarationDir&rdquo;: &ldquo;./dist/types&rdquo;
</span><span class='line'>    },
</span><span class='line'>    &ldquo;include&rdquo;: [&ldquo;./src/&lt;em>*/&lt;/em>&rdquo;]
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure></p>

<p>其次是测试，测试是库开发的重要环节，它能帮我们验证库是否正常工作，后续迭代重构也要依赖它。通常的做法是使用测试框架，像 Angular 是 <a href="https://karma-runner.github.io/">Karma test runner</a>  搭配<a href="https://jasmine.github.io/">Jasmine test framework</a> ， 我们可以参考选择。</p>

<p>我这里还玩了一下用 rollup 打包, 然后在浏览器里运行测试用例。首先在库工程目录外重新创建一个测试工程，然后使用 <code>npm link</code> 命令来安装我们的开发库，具体目录结构和文件内容如下：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$mkdir test-simple-module-example
</span><span class='line'>├── Test.ts
</span><span class='line'>├── dist
</span><span class='line'>│   ├── esm
</span><span class='line'>│   └── test-simple-module-example.js
</span><span class='line'>├── index.html
</span><span class='line'>├── package-lock.json
</span><span class='line'>├── package.json
</span><span class='line'>├── rollup.config.js
</span><span class='line'>└── tsconfig.json</span></code></pre></td></tr></table></div></figure></p>

<p><code>Test.ts</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import { StringValidator, ZipCodeValidator, LettersOnlyValidator } from &ldquo;simple-module-example&rdquo;;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>// Some samples to try
</span><span class='line'>let strings = [&ldquo;Hello&rdquo;, &ldquo;98052&rdquo;, &ldquo;101&rdquo;];&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>// Validators to use
</span><span class='line'>let validators: { [s: string]: StringValidator } = {};
</span><span class='line'>validators[&ldquo;ZIP code&rdquo;] = new ZipCodeValidator();
</span><span class='line'>validators[&ldquo;Letters only&rdquo;] = new LettersOnlyValidator();&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>// Show whether each string passed each validator
</span><span class='line'>strings.forEach((s) => {
</span><span class='line'>  for (let name in validators) {
</span><span class='line'>    console.log(
</span><span class='line'>      &lt;code>"${s}" - ${
</span><span class='line'>        validators[name].isAcceptable(s) ? "matches" : "does not match"
</span><span class='line'>      } ${name}&lt;/code>
</span><span class='line'>    );
</span><span class='line'>  }
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure></p>

<p><code>package.json</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>    &ldquo;name&rdquo;: &ldquo;test-simple-module-example&rdquo;,
</span><span class='line'>    &ldquo;version&rdquo;: &ldquo;1.0.0&rdquo;,
</span><span class='line'>    &ldquo;description&rdquo;: &ldquo;A test application for simple module example.&rdquo;,
</span><span class='line'>    &ldquo;main&rdquo;: &ldquo;.dist/Test.js&rdquo;,
</span><span class='line'>    &ldquo;scripts&rdquo;: {
</span><span class='line'>        &ldquo;clean&rdquo;: &ldquo;rm -rf ./dist&rdquo;,
</span><span class='line'>        &ldquo;build&rdquo;: &ldquo;npm run clean &amp;&amp; npm run build:esm &amp;&amp; npm run build:bundle&rdquo;,
</span><span class='line'>        &ldquo;build:esm&rdquo;: &ldquo;tsc &ndash;module es2015 &ndash;outDir dist/esm&rdquo;,
</span><span class='line'>        &ldquo;build:bundle&rdquo;: &ldquo;rollup -c&rdquo;,
</span><span class='line'>        &ldquo;test&rdquo;: &ldquo;echo \"Error: no test specified\&rdquo; &amp;&amp; exit 1"
</span><span class='line'>    },
</span><span class='line'>    &ldquo;author&rdquo;: &ldquo;Meiliang Dong&rdquo;,
</span><span class='line'>    &ldquo;license&rdquo;: &ldquo;MIT&rdquo;,
</span><span class='line'>    &ldquo;dependencies&rdquo;: {
</span><span class='line'>        &ldquo;@tsconfig/recommended&rdquo;: &ldquo;^1.0.1&rdquo;
</span><span class='line'>    },
</span><span class='line'>    &ldquo;devDependencies&rdquo;: {
</span><span class='line'>        &ldquo;@rollup/plugin-node-resolve&rdquo;: &ldquo;^9.0.0&rdquo;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure></p>

<p><code>rollup.config.js</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import resolve from &lsquo;@rollup/plugin-node-resolve&rsquo;;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>export default {
</span><span class='line'>    input: &lsquo;dist/esm/Test.js&rsquo;,
</span><span class='line'>    output: {
</span><span class='line'>        file: &lsquo;dist/test-simple-module-example.js&rsquo;,
</span><span class='line'>        format: &lsquo;umd&rsquo;
</span><span class='line'>    },
</span><span class='line'>    plugins: [resolve()]
</span><span class='line'>};</span></code></pre></td></tr></table></div></figure></p>

<p><code>tsconfig.json</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  &ldquo;extends&rdquo;: &ldquo;@tsconfig/recommended/tsconfig.json&rdquo;,
</span><span class='line'>  &ldquo;compilerOptions&rdquo;: {
</span><span class='line'>    &ldquo;outDir&rdquo;: &ldquo;./dist&rdquo;,
</span><span class='line'>    &ldquo;target&rdquo;: &ldquo;es5&rdquo;,
</span><span class='line'>    &ldquo;sourceMap&rdquo;: true,
</span><span class='line'>    &ldquo;moduleResolution&rdquo;: &ldquo;Node&rdquo;
</span><span class='line'>  },
</span><span class='line'>  &ldquo;include&rdquo;: [&ldquo;./*.ts&rdquo;]
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure></p>

<p>最后是根据需要选择发布方式，例如发布到 npm 公有仓库，具体做法参考官方文档就好了。</p>

<h3>Reference</h3>

<ul>
<li><a href="https://www.freecodecamp.org/news/anatomy-of-js-module-systems-and-building-libraries-fadcd8dbd0e/">Learn the basics of the JavaScript module system and build your own library</a></li>
<li><a href="https://gist.github.com/jayphelps/51bafb4505558736fdba0aaf8bfe69d3">TypeScript output es2015, esm (ES Modules), CJS, UMD, UMD + Min + Gzip.</a></li>
<li><a href="http://ifandelse.com/its-not-hard-making-your-library-support-amd-and-commonjs/">It&rsquo;s Not Hard: Making Your Library Support AMD and CommonJS</a></li>
<li><a href="https://addyosmani.com/writing-modular-js/">Writing Modular JavaScript With AMD, CommonJS &amp; ES Harmony</a></li>
<li><a href="https://yanhaijing.com/javascript/2018/08/17/2020-js-lib/">如何写一个现代的JavaScript库</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux 使用笔记(三)]]></title>
    <link href="http://DamianSheldon.github.io/blog/linux-useful-command-line-part-3.html"/>
    <updated>2020-09-02T11:40:17+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/linux-useful-command-line-part-3</id>
    <content type="html"><![CDATA[<h3>1.系统迁移和备份</h3>

<p>A:为了数据安全，我们需要对系统备份，换新电脑或者更换云服务时我们需要迁移系统。Linux 系统备份和迁移的方法很多，我这里打算使用 tar 。</p>

<h4>系统备份</h4>

<p>首先是根据自己的实际情况列出需要备份的目录，通常有：</p>

<ul>
<li><code>/etc/</code></li>
<li><code>/home/</code></li>
<li><code>/var/spool/mail/</code></li>
<li><code>/var/spool/cron/</code></li>
<li><code>/root</code></li>
<li><code>/usr/local/bin</code></li>
</ul>


<p>然后使用 tar 命令打包：</p>

<pre><code>tar -jcv -f /backups/backup-system-20200902.tar.bz2 \
&gt; --exclude=/root/*.bz2 --exclude=/root/*.gz --exclude=/home/loop* \
&gt; /etc /home /var/spool/mail /var/spool/cron /root /usr/local/bin
</code></pre>

<h4>系统恢复</h4>

<p>首先可以将备份解压到 <code>/tmp</code> 目录，之后使用 rsync 命令复制到对应目录便可恢复。</p>

<pre><code>tar -jxv -f /backups/backup-system-20200902.tar.bz2 -C /tmp
rsync -avuz /tmp/etc/ /etc
rsync -avuz /tmp/home/ /home
rsync -avuz /tmp/var/spool/mail/ /var/spool/mail
rsync -avuz /tmp/var/spool/cron/ /var/spool/cron
rsync -avuz /tmp/root/ /root
rsync -avuz /tmp/usr/local/bin/ /usr/local/bin
</code></pre>

<!--more-->


<h4><del>系统迁移</del></h4>

<p><del>换新电脑或者更换云服务时我们可能不想要上面那么麻烦，而可能想直接迁移系统，至少我是这么想的，这时我们可以使用下面的方法：</del></p>

<pre><code># 全系统备份
tar --create --absolute-names --preserve-permissions --bzip2  --file=/media/sf_Windows10-shared-folder/virtual-box-centos-8.tar.bz2 --exclude=/dev --exclude=/media --exclude=/metainfo --exclude=/mnt --exclude=/proc --exclude=/run --exclude=/sys  --exclude=/tmp --exclude=/var --exclude=/@System.solv /

# 如有需要也可检查备份的文件
tar -tjpPvf /media/sf_Windows10-shared-folder/virtual-box-centos-8.tar.bz2 | less

# 将备份包放到 /tmp 下解压
tar -xjvf virtual-box-centos-8.tar.bz2
</code></pre>

<p>Reference:</p>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/migrate_installation_to_new_hardware">Migrate installation to new hardware</a></li>
<li><a href="https://www.digitalocean.com/community/tutorial_series/how-to-migrate-to-a-new-linux-server">How To Migrate to a New Linux Server</a></li>
</ul>


<h3>2.dnf list plugins command missing</h3>

<p>A:The information is provided for nearly all command with &ldquo;-v&rdquo; option. See:</p>

<p>Loaded plugins: builddep, changelog, config-manager, copr, debug, debuginfo-install, download, generate_completion_cache, needs-restarting, playground, product-id, repoclosure, repodiff, repograph, repomanage, reposync, subscription-manager, uploadprofile
Updating Subscription Management repositories.</p>

<p>Reference:</p>

<ul>
<li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1694041">dnf list plugins command missing</a></li>
</ul>


<h3>3.How to add startup application on CentOS 8?</h3>

<p>A:We can add by gnome tweaks. Of course you should install it with Software.</p>

<p>Reference:</p>

<ul>
<li><a href="https://linuxhint.com/tweaking_gnome_desktop_centos8/">Tweaking GNOME Desktop Environment on CentOS 8</a></li>
</ul>


<h3>4.开启 CentOS 8 上 tomcat 9 的注意事项</h3>

<p>A:首先是安装 <code>tomcat-native</code>；其次是注意从日志文件中定位错误。我遇到了证书文件权限导致找不到文件的情况。</p>

<h3>5.man: can&rsquo;t set the locale; make sure <code>$LC_*</code> and <code>$LANG</code> are correct</h3>

<p>A:问题是由于 ssh 终端的 locale 设置导致系统的 locale 设置出现问题，我关闭了 sshd_config 中 locale 相关的设置，使用系统的 locale 设置。</p>

<p>Reference:</p>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/Locale#Make_locale_changes_immediate">Locale</a></li>
<li><a href="https://access.redhat.com/solutions/974273">How to change system locale on RHEL7?</a></li>
</ul>


<h3>6.在 CentOS 8 上使用 alternatives 设置默认的 java</h3>

<p>A: 在 CentOS 8 上安装 java 包之后不知为什么 alternatives 中的配置居然不对，导致提示 java command not found，于是只好手动配置：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>初始情况如下&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>$ sudo alternatives  &ndash;list
</span><span class='line'>libnssckbi.so.x86_64    auto    /usr/lib64/pkcs11/p11-kit-trust.so
</span><span class='line'>python                  manual  /usr/bin/python3
</span><span class='line'>ifup                    auto    /usr/libexec/nm-ifup
</span><span class='line'>cifs-idmap-plugin       auto    /usr/lib64/cifs-utils/cifs_idmap_sss.so
</span><span class='line'>python3                 auto    /usr/bin/python3.6
</span><span class='line'>nmap                    auto    /usr/bin/ncat
</span><span class='line'>java                    manual  /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-0.el8_2.x86_64/jre/bin/java
</span><span class='line'>jre_openjdk             auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-0.el8_2.x86_64/jre
</span><span class='line'>jre_1.8.0               auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-0.el8_2.x86_64/jre
</span><span class='line'>jre_1.8.0_openjdk       auto    /usr/lib/jvm/jre-1.8.0-openjdk-1.8.0.262.b10-0.el8_2.x86_64
</span><span class='line'>links                   manual  /usr/bin/elinks
</span><span class='line'>javac                   auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64/bin/javac
</span><span class='line'>java_sdk_openjdk        auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64
</span><span class='line'>java_sdk_1.8.0          auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64
</span><span class='line'>java_sdk_1.8.0_openjdk  auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>确认下正确设置的相关参数&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>$ alternatives &ndash;display java_sdk_openjdk
</span><span class='line'>java_sdk_openjdk - status is auto.
</span><span class='line'> link currently points to /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64
</span><span class='line'>/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64 - family java-1.8.0-openjdk.x86_64 priority 1800265
</span><span class='line'>Current `best' version is /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>设置默认 java 相关功能的路径&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>sudo alternatives &ndash;install /usr/bin/java java /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64/jre/bin/java 1800265 &ndash;family java-1.8.0-openjdk.x86_64&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>sudo alternatives &ndash;install /usr/lib/jvm/jre_openjdk jre_openjdk /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64/jre 1800265 &ndash;family java-1.8.0-openjdk.x86_64&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>sudo alternatives &ndash;install /usr/lib/jvm/jre_1.8.0 jre_1.8.0 /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64/jre 1800265 &ndash;family java-1.8.0-openjdk.x86_64&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>sudo alternatives &ndash;install /usr/lib/jvm/jre_1.8.0_openjdk jre_1.8.0_openjdk /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64 1800265 &ndash;family java-1.8.0-openjdk.x86_64&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>确认设置结果&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>$ alternatives &ndash;list
</span><span class='line'>libnssckbi.so.x86_64    auto    /usr/lib64/pkcs11/p11-kit-trust.so
</span><span class='line'>python                  manual  /usr/bin/python3
</span><span class='line'>ifup                    auto    /usr/libexec/nm-ifup
</span><span class='line'>cifs-idmap-plugin       auto    /usr/lib64/cifs-utils/cifs_idmap_sss.so
</span><span class='line'>python3                 auto    /usr/bin/python3.6
</span><span class='line'>nmap                    auto    /usr/bin/ncat
</span><span class='line'>links                   manual  /usr/bin/elinks
</span><span class='line'>javac                   auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64/bin/javac
</span><span class='line'>java_sdk_openjdk        auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64
</span><span class='line'>java_sdk_1.8.0          auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64
</span><span class='line'>java_sdk_1.8.0_openjdk  auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64
</span><span class='line'>java                    auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64/jre/bin/java
</span><span class='line'>jre_openjdk             auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64/jre
</span><span class='line'>jre_1.8.0               auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64/jre
</span><span class='line'>jre_1.8.0_openjdk       auto    /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64</span></code></pre></td></tr></table></div></figure></p>

<p>另外我们还可以在 <code>/etc/profile.d</code> 目录下新建 <code>java.sh</code> 文件来设置 <code>JAVA_HOME</code> 和 <code>JRE_HOME</code>：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>/etc/profile.d/java.sh&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>JAVA_HOME=&ldquo;/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64&rdquo;
</span><span class='line'>JRE_HOME=&ldquo;/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.265.b01-0.el8_2.x86_64/jre&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p>Reference:</p>

<ul>
<li><a href="https://www.redhat.com/sysadmin/alternatives-command">Introduction to the alternatives command in Linux</a></li>
</ul>


<h3>7. chsh command not available on CentOS 8</h3>

<p>A:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ dnf provides &lsquo;*/chsh&rsquo;
</span><span class='line'>Last metadata expiration check: 8 days, 1:03:13 ago on Thu 01 Oct 2020 03:47:40 AM UTC.
</span><span class='line'>util-linux-user-2.32.1-22.el8.x86_64 : libuser based util-linux utilities
</span><span class='line'>Repo        : BaseOS
</span><span class='line'>Matched from:
</span><span class='line'>Filename    : /etc/pam.d/chsh
</span><span class='line'>Filename    : /usr/bin/chsh
</span><span class='line'>Filename    : /usr/share/bash-completion/completions/chsh&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>$ rpm -q util-linux-user-2.32.1-22.el8.x86_64
</span><span class='line'>package util-linux-user-2.32.1-22.el8.x86_64 is not installed&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>$ sudo dnf install util-linux-user-2.32.1-22.el8.x86_64</span></code></pre></td></tr></table></div></figure></p>

<ul>
<li><a href="https://forums.centos.org/viewtopic.php?t=73864">CentOS 8.0.1905 - &lsquo;chsh&rsquo; : command not found</a></li>
</ul>


<h3>8. rsync 同步目录时产生了很多以 <code>~</code> 结尾的文件</h3>

<p>A:原因是加上了 b 选项，会对文件做备份</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rsync -avuzb treasure-workspace/dist/treasure/ treasure-lib-dist</span></code></pre></td></tr></table></div></figure></p>

<p>Reference:</p>

<ul>
<li><a href="https://unix.stackexchange.com/questions/76189/what-does-the-tilde-mean-at-the-end-of-a-filename">What does the tilde (~) mean at the end of a filename? </a></li>
<li><a href="https://unix.stackexchange.com/questions/132669/what-is-bitwise-c?noredirect=1&amp;lq=1">What is bitwise.c~? </a></li>
</ul>

]]></content>
  </entry>
  
</feed>
