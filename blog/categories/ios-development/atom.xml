<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: ios development | Hello World]]></title>
  <link href="http://DamianSheldon.github.io/blog/categories/ios-development/atom.xml" rel="self"/>
  <link href="http://DamianSheldon.github.io/"/>
  <updated>2016-02-15T20:29:45+08:00</updated>
  <id>http://DamianSheldon.github.io/</id>
  <author>
    <name><![CDATA[Sheldon]]></name>
    <email><![CDATA[dongmeilianghy@sina.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[iOS Unit Testing With OCMock]]></title>
    <link href="http://DamianSheldon.github.io/blog/ios-unit-testing-with-ocmock.html"/>
    <updated>2016-01-22T14:19:12+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/ios-unit-testing-with-ocmock</id>
    <content type="html"><![CDATA[<p>单元测试是我们保障代码质量的重要手段， Apple 对此也十分重视，这点可以从 Xcode 新建工程时会自动创建单元测试的 Target 看出来。单元测试牵涉的内容很多，这篇文章是目前我对单元测试的理解。</p>

<p>既然是单元测试，那么什么是单元呢？我没有去考证，但我是这么理解的：面向对象编程范式里一切皆对象，而对象是由实例变量和方法组成，对象之间通过方法互相作用，我们的应用可以看作是一个对象图，对象图上的对象相互作用来实现我们的需求。这么看来我们的单元应该是对象的方法。</p>

<p>对象的方法在工作的时候可能要依赖其他对象，为了去除依赖对象对测试的影响，我们引入 Mock.</p>

<blockquote><p>Mocks are ‘fake’ objects with pre-defined behavior to stand-in for concrete objects during testing. &ndash; HackaZach</p></blockquote>

<p>引用 Mock 之后，我们在单元测试中如何使用它呢？</p>

<blockquote><p>The general recipe for using mocks in unit-tests is:</p>

<ol>
<li>Create the mock object</li>
<li>Specify the expected invocations and return values</li>
<li>Associate the mock object with the code under test</li>
<li>Execute the code under test</li>
<li>Validate that your assertions are correct</li>
</ol>
</blockquote>

<!-- more -->


<h3>Create the mock object</h3>

<p>OCMock 中创建 Mock 对象的方法如下：</p>

<table>
<thead>
<tr>
<th> Factory Method </th>
<th> Description </th>
</tr>
</thead>
<tbody>
<tr>
<td> +mockForClass: </td>
<td> Create a mock based on the given class </td>
</tr>
<tr>
<td> +mockForProtocol: </td>
<td> Create a mock based on the given protocol </td>
</tr>
<tr>
<td> +niceMockForClass: </td>
<td> Create a &ldquo;nice&rdquo; mock based on the given class </td>
</tr>
<tr>
<td> +niceMockForProtocol: </td>
<td> Create a &ldquo;nice&rdquo; mock based on the given protocol </td>
</tr>
<tr>
<td> +partialMockForObject: </td>
<td> Create a mock based on the given object </td>
</tr>
<tr>
<td> +observerMock: </td>
<td> Create a notification observer (more on this later) </td>
</tr>
</tbody>
</table>


<p>Mock 对象是只是一个空壳，只能调用预先定义的方法，调用没有预先定义的方法会抛出异常；
Nice Mock 对象也是一个空壳，只是它会忽略没有预先定义的方法不会抛出异常；
Partial Mock 对象是把一个已有的对象转成 Mock，调用没有预先定义的方法，它会把方法传给已存在的对象；<br/>
Observer Mock 对象是用来观察通知的。</p>

<h3>Specify the expected invocations and return values</h3>

<blockquote><p>Calling either the -expect or -stub method will return an object that you can use to setup your expectations.</p></blockquote>

<ul>
<li><p>Specify the expected invocations</p>

<ol>
<li>不带参数的方法</li>
</ol>
</li>
</ul>


<pre><code>
- (void)testInit {
  id mockService = [OCMockObject mockForProtocol:@protocol(AVQuoteService)];
  [[mockService expect] initiateConnection];

  AVStockPortfolio *portfolio = [[AVStockPortfolio alloc] initWithService:mockService];

  [mockService verify];
}
</code></pre>

<p></br>
    2. 带参数的方法</p>

<blockquote><p>You can use any of the following OCMArg class methods in place of a real argument when setting up your method expectations:</p></blockquote>

<table>
<thead>
<tr>
<th> OCMArg method </th>
<th> Description </th>
</tr>
</thead>
<tbody>
<tr>
<td> +any </td>
<td> Any argument is accepted. </td>
</tr>
<tr>
<td> +anyPointer </td>
<td> Accepts any pointer </td>
</tr>
<tr>
<td> +isNil     </td>
<td> The given argument must be nil </td>
</tr>
<tr>
<td> +isNotNil  </td>
<td> The given argument must not be nil </td>
</tr>
<tr>
<td> +isNotEqual:   </td>
<td> Given argument is not object-equivalent with expectation </td>
</tr>
<tr>
<td> +checkWithSelector: </td>
<td> onObject:   Check the argument with the given action/target pair </td>
</tr>
<tr>
<td> +checkWithBlock: </td>
<td> Check the argument with the given block (OS X 10.6 or iOS 4) </td>
</tr>
</tbody>
</table>


<blockquote><p>OCMock also provides a few handy macros for argument matching:</p></blockquote>

<table>
<thead>
<tr>
<th> Macro </th>
<th> Description </th>
</tr>
</thead>
<tbody>
<tr>
<td> OCMOCK_ANY()   </td>
<td> Equivalent to [OCMArg any] </td>
</tr>
<tr>
<td> OCMOCK_VALUE(value) </td>
<td> A quick way to match a non-object argument </td>
</tr>
<tr>
<td> CONSTRAINT(selector) </td>
<td> Validate with a given selector on self </td>
</tr>
<tr>
<td> CONSTRAINTV(selector,value) </td>
<td>     Validate with a given selector on self and an additional argument </td>
</tr>
</tbody>
</table>


<pre><code>id classMock = OCMClassMock([SomeClass class]);
OCMExpect([classMock someMethodWithArgument:[OCMArg isNotNil]]);

/* run code under test, which is assumed to call someMethod */

OCMVerifyAll(classMock)
</code></pre>

<p></br>
    3. 通知</p>

<pre><code>- (void)testSellSharesInStock {
  id mock = [OCMockObject observerMock];
  // OCMock adds a custom methods to NSNotificationCenter via a category
  [[NSNotificationCenter defaultCenter] addMockObserver:mock
                                                   name:AVStockSoldNotification
                                                 object:nil];

  [[mock expect] notificationWithName:AVStockSoldNotification object:[OCMArg any]];

  AVPortfolio *portfolio = [self createPortfolio]; // made-up factory method
  [portfolio sellShares:100 inStock:@"AAPL"];

  [mock verify];
}
</code></pre>

<ul>
<li>Specify the return values</li>
</ul>


<blockquote><p>If methods on your mocks need to return values, you have a variety of methods to call on the object returned by -expect or -stub.</p></blockquote>

<table>
<thead>
<tr>
<th> Method </th>
<th> Explanation </th>
</tr>
</thead>
<tbody>
<tr>
<td> -andReturn: </td>
<td> Return the given object </td>
</tr>
<tr>
<td> -andReturnValue: </td>
<td> Return a non-object value (wrapped in a NSValue) </td>
</tr>
<tr>
<td> -andThrow: </td>
<td> Throw the given exception </td>
</tr>
<tr>
<td> -andPost: </td>
<td>   Post the given notification </td>
</tr>
<tr>
<td> -andCall:onObject: </td>
<td> Call the selector on the given object </td>
</tr>
<tr>
<td> -andDo: </td>
<td> Invoke the given block (only on OS X 10.6 or iOS 4) </td>
</tr>
</tbody>
</table>


<h3>Execution &amp; Validation</h3>

<ul>
<li>Associate the mock object with the code under test</li>
<li>Execute the code under test</li>
<li>Validate that your assertions are correct</li>
</ul>


<pre><code>- (void)testSellSharesInStock {
  id quoteService = [[OCMockObject] mockForProtocol:@protocol(AVQuoteService)];
  [[[quoteService expect] andDo:^(NSInvocation *invocation) {
    // validate arguments, set return value on the invocation object
  }] priceForStock:@"AAPL"];

  // Associate the mock object with the code under test
  AVStockPortfolio *portfolio = [[AVStockPortfolio alloc] initWithService:quoteService];
  // Execute the code under test
  [portfolio sellShares:100 inStock:@"AAPL"];

  // Validate that your assertions are correct

  [quoteService verify];
}
</code></pre>

<p>Q:How to mocking singleton?
A:</p>

<pre><code>// we can replace it with a mock object
id mockManager = [OCMockObject mockForClass:[ArticleManager class]];
[ArticleManager setSharedInstance:mockManager];
// we can reset it so that it returns the actual ArticleManager
[ArticleManager setSharedInstance:nil];

// Objective-C Singleton Pattern Updated For Testability
@implementation ArticleManager

static ArticleManager *_sharedInstance = nil;
static dispatch_once_t once_token = 0;

+(instancetype)sharedInstance {
    dispatch_once(&amp;once_token, ^{
        if (_sharedInstance == nil) {
            _sharedInstance = [[ArticleManager alloc] init];
        }
    });
    return _sharedInstance;
}

+(void)setSharedInstance:(ArticleManager *)instance {
    once_token = 0; // resets the once_token so dispatch_once will run again
    _sharedInstance = instance;
}

@end
</code></pre>

<p>Reference:<a href="http://twobitlabs.com/2013/01/objective-c-singleton-pattern-unit-testing/">Objective-C Singleton Pattern Updated For Testability</a></p>

<h2>Reference:</h2>

<p><a href="http://ocmock.org">OCMock</a><br/>
<a href="http://www.archive.alexvollmer.com/posts/2010/06/28/making-fun-of-things-with-ocmock/">Making Fun of Things with OCMock</a><br/>
<a href="http://hackazach.net/code/2014/03/03/effective-testing-with-ocmock/">OCMock Test Origami</a><br/>
<a href="http://engineering.aweber.com/improving-ios-unit-tests-with-ocmock/">IMPROVING IOS UNIT TESTS WITH OCMOCK</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS App 开发问题汇总（五）]]></title>
    <link href="http://DamianSheldon.github.io/blog/ios-development-problems-part-5.html"/>
    <updated>2016-01-08T21:32:22+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/ios-development-problems-part-5</id>
    <content type="html"><![CDATA[<h3>1.On iOS 7 and later, how do I take a snapshot of my view and save the result in a UIImage?</h3>

<p>Solution:</p>

<pre><code>- (UIImage *)snapshot:(UIView *)view
{
    UIGraphicsBeginImageContextWithOptions(view.bounds.size, YES, 0);
    [view drawViewHierarchyInRect:view.bounds afterScreenUpdates:YES];
    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    return image;
}
</code></pre>

<p>Reference:<a href="https://developer.apple.com/library/ios/qa/qa1817/_index.html">https://developer.apple.com/library/ios/qa/qa1817/_index.html</a></p>

<h3>2.How to present a view controller on iOS7 without the status bar overlapping?</h3>

<p>Solution:The easiest workaround I&rsquo;ve found is to wrap the view controller you want to present inside a navigation controller, and then present that navigation controller.</p>

<pre><code>MyViewController *vc = [MyViewController new];
UINavigationController *nvc = [[UINavigationController alloc] 
    initWithRootViewController:vc];
[self presentViewController:nvc animated:YES completion:nil];
</code></pre>

<h3>3.代码创建 UITableView 时如何使用各种系统样式的 UITableViewCell?</h3>

<p>Solution:</p>

<pre><code>- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    static NSString *sCellID = @"CellID";

    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:sCellID];
    if (!cell) {
        cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:sCellID];
    }
    // Configure the cell...

    return cell;
}
</code></pre>

<!-- more -->


<h3>4.Settings bundle not showing up in iPhone settings</h3>

<p>Solution:iOS 9.0.x - 9.2 Settings App Bug, Using the App Switch UI (double-press Home button) to kill the Settings App.</p>

<p>Reference:<a href="http://stackoverflow.com/questions/2683793/settings-bundle-not-showing-up-in-iphone-settings">http://stackoverflow.com/questions/2683793/settings-bundle-not-showing-up-in-iphone-settings</a></p>

<h3>5.单元测试的 Target 在测试导航栏里是灰色的不能点击测试。</h3>

<p>Solution: Edit Scheme &hellip; > Test > + > Select your test target.</p>

<h3>6.How to change UITableViewCell Image to Circle in UITableView</h3>

<p>Solution:</p>

<pre><code>// Subclass UITableViewCell override layoutSubviews method

- (void)layoutSubviews
{
    [super layoutSubviews];

    self.imageView.layer.cornerRadius = CGRectGetHeight(self.imageView.frame) * 0.5;
    self.imageView.layer.masksToBounds = YES;
}
</code></pre>

<p>Reference:<a href="http://stackoverflow.com/questions/23350728/how-to-change-uitableviewcell-image-to-circle-in-uitableview">http://stackoverflow.com/questions/23350728/how-to-change-uitableviewcell-image-to-circle-in-uitableview</a></p>

<h3>7.How to downgrading Cocoapods?</h3>

<p>A:</p>

<pre><code>// First you can figure out which version of Cocoapods you are on with the command:
$ pod --version

// You can also see all the version of Cocoapods you have installed with this command:
$ sudo gem list cocoapods

// Next uninstall Cocoapods. If you have multiple version, you will have the choice of uninstalling all or a specific version.
$ sudo gem uninstall cocoapods

// Finally you can install the specific version with this command:
$ sudo gem install cocoapods -v 0.39.0
</code></pre>

<p>Reference:<a href="https://diego.org/2015/09/24/downgrading-cocoapods/">https://diego.org/2015/09/24/downgrading-cocoapods/</a></p>

<h3>8.How to get UISearchDisplayController to search only after search button is pressed？</h3>

<p>A:Setup a delegate for the search bar and implement the searchBarSearchButtonClicked: method. Do your searching from that method. Just return NO from the shouldReloadTableForSearchString method.</p>

<p>Reference:<a href="http://stackoverflow.com/questions/18563529/how-to-get-uisearchdisplaycontroller-to-search-only-after-search-button-is-press">http://stackoverflow.com/questions/18563529/how-to-get-uisearchdisplaycontroller-to-search-only-after-search-button-is-press</a></p>

<h3>9.Warning: the running version of Bundler is older than the version that created the lockfile. We suggest you upgrade to the latest version of Bundler by running <code>gem install bundler</code>.</h3>

<p>A:</p>

<pre><code>$ sudo gem install bundler
$ bundle install

...
An error occurred while installing git (1.2.9.1), and Bundler cannot continue.
Make sure that `gem install git -v '1.2.9.1'` succeeds before bundling.

$ sudo gem install git -v '1.2.9.1'
$ sudo gem install lowdown -v '0.0.5' --verbose
...
ERROR:  Error installing lowdown:
    lowdown requires Ruby version &gt;= 2.1.0.

$ ruby --version
ruby 2.0.0p645 (2015-04-13 revision 50299) [universal.x86_64-darwin15]
// On OS X machines, you can use third-party tools (rbenv and RVM).
// Install RVM:
$ \curl -sSL https://get.rvm.io | bash -s stable --ruby=2.1.8

* To start using RVM you need to run `source /Users/dongmeiliang/.rvm/scripts/rvm`
    in all your open shell windows, in rare cases you need to reopen all shell windows.
$ source /Users/dongmeiliang/.rvm/scripts/rvm

// Check rvm has been installed successfully
$ rvm --help

$ bundle install
/System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/rubygems/dependency.rb:296:in `to_specs': Could not find 'bundler' (&gt;= 0) among 13 total gem(s) (Gem::LoadError)
    from /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/rubygems/dependency.rb:307:in `to_spec'
    from /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/rubygems/core_ext/kernel_gem.rb:47:in `gem'
    from /usr/local/bin/bundle:22:in `&lt;main&gt;'

We need reinstall bundler after update ruby:
$ gem install bundler
Fetching: bundler-1.11.2.gem (100%)
Successfully installed bundler-1.11.2
Parsing documentation for bundler-1.11.2
Installing ri documentation for bundler-1.11.2
Done installing documentation for bundler after 6 seconds
1 gem installed

//bundle - Ruby Dependency Management
//gem -- RubyGems program, RubyGems is a sophisticated package manager for Ruby.
//rvm - The Ruby Version Manager
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[用 Wireshark 抓 iPhone 网络请求的数据包]]></title>
    <link href="http://DamianSheldon.github.io/blog/capturing-iphone-traffic-on-wireshark.html"/>
    <updated>2016-01-04T14:43:00+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/capturing-iphone-traffic-on-wireshark</id>
    <content type="html"><![CDATA[<p>开发过程中经常可能遇到网络问题，这时候我们需要抓包来定位问题所在。那么如何用 Wireshark 抓取 iPhone 真机网络请求的数据包呢？</p>

<blockquote><p>iOS does not support packet tracing directly. However, if you&rsquo;re developing for iOS you can take a packet trace of your app in a number of different ways:</p>

<p>If the problem you&rsquo;re trying to debug occurs on Wi-Fi, you can put your iOS device on a test Wi-Fi network. See Wi-Fi Capture for details.<br/>
If your app uses HTTP, you can configure your iOS device to use a debugging HTTP proxy (such as Charles HTTP Proxy).<br/>
In iOS 5 and later you can use the remote virtual interface facility.</p></blockquote>

<!-- more -->


<p>这里我使用的是第三种方法：remote virtual interface。</p>

<p>iOS 5 added a remote virtual interface (RVI) facility that lets you use OS X packet trace programs to capture traces from an iOS device. The basic strategy is:</p>

<ol>
<li>Connect your iOS device to your Mac via USB.</li>
<li>Set up an RVI for that device. This creates a virtual network interface on your Mac that represents the iOS device&rsquo;s networking stack.</li>
<li>Run your OS X packet trace program, and point it at the RVI created in the previous step.</li>
</ol>


<pre><code>$ # First get the current list of interfaces.
$ ifconfig -l
lo0 gif0 stf0 en0 en1 p2p0 fw0 ppp0 utun0
$ # Get connected device's UDID follow: Xcode &gt; Window &gt; Devices &gt; Select connected device &gt; identifier
$ # Then run the tool with the UDID of the device.
$ rvictl -s 74bd53c647548234ddcef0ee3abee616005051ed

Starting device 74bd53c647548234ddcef0ee3abee616005051ed [SUCCEEDED]

$ # Get the list of interfaces again, and you can see the new virtual
$ # network interface, rvi0, added by the previous command.
$ ifconfig -l
lo0 gif0 stf0 en0 en1 p2p0 fw0 ppp0 utun0 rvi0
</code></pre>

<p>打开 Wireshark, 选择 rvi0 作为待抓包的接口。</p>

<h1>Reference</h1>

<p><a href="https://developer.apple.com/library/mac/qa/qa1176/_index.html">Getting a Packet Trace</a><br/>
<a href="http://stackoverflow.com/questions/9555403/capturing-mobile-phone-traffic-on-wireshark">Capturing mobile phone traffic on wireshark</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS App 开发问题汇总（四）]]></title>
    <link href="http://DamianSheldon.github.io/blog/ios-devleopment-problems-part-4.html"/>
    <updated>2015-10-15T15:04:13+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/ios-devleopment-problems-part-4</id>
    <content type="html"><![CDATA[<h3>1. Suppressing deprecated warnings</h3>

<pre><code>#pragma clang diagnostic push
#pragma clang diagnostic ignored "-Wdeprecated-declarations"
[reciver deprecatedMethod];
#pragma clang diagnostic pop
</code></pre>

<h3>2. Warning libopencore-amrnb.a, missing required architecture arm64</h3>

<pre><code>ld: warning: ignoring file /Users/dongmeiliang/Downloads/VoiceConvert/VoiceConvert/VoiceConvert/lib/libopencore-amrnb.a, missing required architecture arm64 in file /Users/dongmeiliang/Downloads/VoiceConvert/VoiceConvert/VoiceConvert/lib/libopencore-amrnb.a (3 slices)
ld: warning: ignoring file /Users/dongmeiliang/Downloads/VoiceConvert/VoiceConvert/VoiceConvert/lib/libopencore-amrwb.a, missing required architecture arm64 in file /Users/dongmeiliang/Downloads/VoiceConvert/VoiceConvert/VoiceConvert/lib/libopencore-amrwb.a (3 slices)
Undefined symbols for architecture arm64:
  "_Decoder_Interface_init", referenced from:
      DecodeAMRFileToWAVEFile(char const*, char const*) in libVoiceConvert.a(amrFileCodec.o)
  "_Decoder_Interface_Decode", referenced from:
      DecodeAMRFileToWAVEFile(char const*, char const*) in libVoiceConvert.a(amrFileCodec.o)
  "_Decoder_Interface_exit", referenced from:
      DecodeAMRFileToWAVEFile(char const*, char const*) in libVoiceConvert.a(amrFileCodec.o)
  "_Encoder_Interface_init", referenced from:
      EncodeWAVEFileToAMRFile(char const*, char const*, int, int) in libVoiceConvert.a(amrFileCodec.o)
  "___gxx_personality_v0", referenced from:
      +[VoiceConverter amrToWav:wavSavePath:] in libVoiceConvert.a(VoiceConverter.o)
      +[VoiceConverter wavToAmr:amrSavePath:] in libVoiceConvert.a(VoiceConverter.o)
  "_Encoder_Interface_Encode", referenced from:
      EncodeWAVEFileToAMRFile(char const*, char const*, int, int) in libVoiceConvert.a(amrFileCodec.o)
  "_Encoder_Interface_exit", referenced from:
      EncodeWAVEFileToAMRFile(char const*, char const*, int, int) in libVoiceConvert.a(amrFileCodec.o)
</code></pre>

<p>Solution: Recompile a static library refer <a href="https://github.com/feuvan/opencore-amr-iOS">opencore-amr-iOS</a></p>

<!-- more -->


<h3>3. Undefined symbols for architecture arm64:</h3>

<p>  &ldquo;___gxx_personality_v0&rdquo;, referenced from:
      +[VoiceConverter amrToWav:wavSavePath:] in libVoiceConvert.a(VoiceConverter.o)
      +[VoiceConverter wavToAmr:amrSavePath:] in libVoiceConvert.a(VoiceConverter.o)
ld: symbol(s) not found for architecture arm64</p>

<p>Solution: Project > Targets > Select your product target > Build Settings > Other Linker Flags > Add -l"stdc++"</p>

<p>Reference:<a href="http://stackoverflow.com/questions/2846679/creating-an-objective-c-static-library-in-xcode">http://stackoverflow.com/questions/2846679/creating-an-objective-c-static-library-in-xcode</a></p>

<h3>4. Suppressing performSelector may cause leaks warnings</h3>

<pre><code>#pragma clang diagnostic push
#pragma clang diagnostic ignored "-Warc-performSelector-leaks"
    [self.ticketTarget performSelector: self.ticketAction withObject: self];
#pragma clang diagnostic pop
</code></pre>

<p>Reference:<a href="http://stackoverflow.com/questions/7017281/performselector-may-cause-a-leak-because-its-selector-is-unknown">http://stackoverflow.com/questions/7017281/performselector-may-cause-a-leak-because-its-selector-is-unknown</a></p>

<h3>5.How to remove UINavigationBar and UISearchBar hairline?</h3>

<p>Solution:</p>

<blockquote><p>For a custom shadow image to be shown, a custom background image must also be set with the setBackgroundImage:forBarMetrics: method. If the default background image is used, then the default shadow image will be used regardless of the value of this property.</p></blockquote>

<p>So we can cut a 1x1 pixel pure color image, set this image as navigation bar&rsquo;s shadow image.</p>

<p>Reference:<a href="http://stackoverflow.com/questions/19037464/how-to-remove-uinavigationbar-and-uisearchbar-hairline">http://stackoverflow.com/questions/19037464/how-to-remove-uinavigationbar-and-uisearchbar-hairline</a><br/>
<a href="http://stackoverflow.com/questions/19226965/how-to-hide-ios7-uinavigationbar-1px-bottom-line">http://stackoverflow.com/questions/19226965/how-to-hide-ios7-uinavigationbar-1px-bottom-line</a></p>

<h3>6. Tab Bar item 设置的默认图片是白色的，但是显示却是灰色</h3>

<p>Solution:</p>

<pre><code>UIImage *userImage = [UIImage imageNamed:@"User"];
userImage = [userImage imageWithRenderingMode:UIImageRenderingModeAlwaysOriginal];
UITabBarItem *friends = [[UITabBarItem alloc] initWithTitle:@"Recommand Friends" image:userImage selectedImage:userImage];
</code></pre>

<h3>7. UIWebView&rsquo;s cache doesn&rsquo;t work</h3>

<p>Solution:</p>

<blockquote><p>Create requestObj with specific cache policy ReturnCacheDataElseLoad if you can tell there is no network, or use the default behavior.</p></blockquote>

<p>Reference:<a href="http://stackoverflow.com/questions/32605084/uiwebview-cache-not-working">http://stackoverflow.com/questions/32605084/uiwebview-cache-not-working</a></p>

<h3>8.How to only show bottom border of UITextField</h3>

<p>Solution:</p>

<pre><code>var bottomLine = CALayer()
bottomLine.frame = CGRectMake(0.0, myTextField.frame.height - 1, myTextField.frame.width, 1.0)
bottomLine.backgroundColor = UIColor.whiteColor().CGColor
myTextField.borderStyle = UITextBorderStyle.None
myTextField.layer.addSublayer(bottomLine)
</code></pre>

<p>Reference:<a href="http://stackoverflow.com/questions/31107994/how-to-only-show-bottom-border-of-uitextfield-in-swift">http://stackoverflow.com/questions/31107994/how-to-only-show-bottom-border-of-uitextfield-in-swift</a></p>

<h3>9. 让Button的大小比它的内容略大</h3>

<p>Solution:</p>

<pre><code>_loginViaSMSButton.contentEdgeInsets = UIEdgeInsetsMake(0, 20, 0, 20);
</code></pre>

<h3>10. UITableViewStyleGrouped style UITableView has extra space at top</h3>

<p>Solution:</p>

<blockquote><p>UITableViewStyleGrouped divides each section into a &ldquo;group&rdquo; by inserting that extra padding…similar to what it did pre-iOS7, but clear instead of colored by default, and just at the top instead of all the way around. If you don&rsquo;t want the padding by default, use UITableViewStylePlain.</p></blockquote>

<p>Otherwise, if you need to keep the style the same, do what this other posted from that link recommended and change the content inset:</p>

<pre><code>self.tableView.contentInset = UIEdgeInsetsMake(-36, 0, 0, 0);
</code></pre>

<p>Reference:<a href="http://stackoverflow.com/questions/20305943/why-extra-space-is-at-top-of-uitableview-simple">http://stackoverflow.com/questions/20305943/why-extra-space-is-at-top-of-uitableview-simple</a></p>

<h3>11. 使用 UISearchDisplayController 遇到的问题</h3>

<p>使用代码创建的 UISearchDisplayController 必须用一个属性来持有它，个人觉得这里有点奇怪，因为 UIViewController 在头文件中的声明是：</p>

<pre><code>@property(nonatomic, readonly, strong) UISearchDisplayController *searchDisplayController
</code></pre>

<p>理论上来讲既然是 strong 那么这个对象应该会存在才对，但不知道什么原因，这样并不行，它会在内存中被销毁，还是得在扩展里用一个属性来持有它。</p>

<pre><code>*.m

@property (nonatomic) UISearchDisplayController *wt_searchDisplayController;

self.wt_searchDisplayController = [[UISearchDisplayController alloc] initWithSearchBar:self.searchBar contentsController:self];
self.wt_searchDisplayController.delegate = self;
self.wt_searchDisplayController.searchResultsDataSource = self.searchCoordinator;
self.wt_searchDisplayController.searchResultsDelegate = self.searchCoordinator;
[self.wt_searchDisplayController.searchResultsTableView registerClass:[RCConversationCell class] forCellReuseIdentifier:sSearchCellIdentifier];
</code></pre>

<p>问题还没有完全解决，我应用的导航结构是 UINavigationController > UITabBarController [VC1, VC 2, VC3], 在 VC1 界面里需要搜索功能，然后我在 VC1 navigation bar 下方放置了一个 search bar， 这个 search bar 和 searchDisplayController 关联起来，结果却出现 search result tableView 覆盖 search bar 的情况，最后的解决办法是调整导航结构 UINavigationController > UITabBarController [(UINavigationController > VC1), (UINavigationController > VC2), (UINavigationController > VC3)], 也就是先把 UIViewController 嵌入到 UINavigationController 中， 再把它做为 UITabBarController 的 childController.</p>

<h3>12. Controller 的视图 Layer 上添加 AVCaptureVideoPreviewLayer， 然后再在 Controller 的 View 上添加一个扫描框视图，用系统的 View 作为扫描框视图时能正常显示相机的捕获的内容， 用自定义的视图时，扫描框内全是黑的。</h3>

<p>Solution:在自定义视图的初始化方法中设置 opaque 为 NO。</p>

<h3>13. You are not authorized to use this service.</h3>

<p>Solution: I recently enable Apple ID two-step verification. When I upload app to App Store via Xcode it inform me &ldquo;You are not authorized to use this service.&rdquo; I feel very strange. I decide to use Application Loader after search with google.  Sign in Application Loader need app-specific password, you can get it follow instructs:</p>

<ol>
<li>Sign in to your <a href="https://appleid.apple.com/account/home">Apple ID account page</a>;</li>
<li>In the Security section, click Edit.</li>
<li>Click Generate Password and follow the steps on your screen.</li>
</ol>


<p>Reference:<a href="https://support.apple.com/en-us/HT204397">https://support.apple.com/en-us/HT204397</a></p>

<p>Now we can upload app with Application Loader:
1. Xcode > Open Developer Tool > Application Loader
2. Sign in Application Loader with app-specific password
3. Click on &ldquo;Choose&rdquo;
4. Pick the IPA you have just exported
5. Follow submission process</p>

<p>Reference:<a href="http://stackoverflow.com/questions/33291394/xcode-7-1-not-authorized-to-use-this-service-error">http://stackoverflow.com/questions/33291394/xcode-7-1-not-authorized-to-use-this-service-error</a></p>

<h3>14.</h3>

<pre><code>ERROR ITMS-90535: "Unexpected CFBundleExecutable Key. The bundle at 'Payload/sohiOSApp.app/TencentOpenApi_IOS_Bundle.bundle' does not contain a bundle executable. If this bundle intentionally does not contain an executable, consider removing the CFBundleExecutable key from its Info.plist and using a CFBundlePackageType of BNDL. If this bundle is part of a third-party framework, consider contacting the developer of the framework for an update to address this issue."
</code></pre>

<p>Solotion:Removing the CFBundleExecutable key from TencentOpenApi_IOS_Bundle.bundle&rsquo;s Info.plist and using a CFBundlePackageType of BNDL.</p>

<h3>15. Pointer is missing a nullability type specifier</h3>

<p>Solution:It&rsquo;s simply because as soon as you supply any nullability information in a header, you are expected to supply nullability information for everything in that header. Either the whole API is unspecified or the whole API is specified, with regard to nullability. The compiler is just warning you that you have left the job half-finished.</p>

<p>Reference:<a href="http://stackoverflow.com/questions/33028900/pointer-is-missing-a-nullability-type-specifier-on-function-interface">http://stackoverflow.com/questions/33028900/pointer-is-missing-a-nullability-type-specifier-on-function-interface</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS App 开发问题汇总（三）]]></title>
    <link href="http://DamianSheldon.github.io/blog/ios-development-problem-part-3.html"/>
    <updated>2015-07-30T11:36:57+08:00</updated>
    <id>http://DamianSheldon.github.io/blog/ios-development-problem-part-3</id>
    <content type="html"><![CDATA[<h3>1.问题描述：Checking the Entitlements for an iOS app Submission to the App Store</h3>

<p>Making an Inspectable .ipa file<br/>
In the Xcode Organizer, instead of Submit to the iOS App Store, do Save for Enterprise or Ad-Hoc Deployment. This will create a local copy of the .ipa file that would be submitted to the App Store.<br/>
When asked to choose the provisioning profile to sign with, select the same distribution profile you use when submitting to the App Store. Take a screenshot of your choice (command-shift-3) so you can verify this step later. During submission, this screenshot will be the only record you have identifying which profile was used to sign the app.<br/>
When asked to save the package, uncheck Save for Enterprise Distribution, then save the .ipa file.<br/>
Checking the Entitlements of an .ipa file<br/>
Find the .ipa file and change its the extension to .zip.<br/>
Expand the .zip file. This will produce a Payload folder containing your .app bundle.<br/>
Use the codesign tool to check the entitlements on the .app bundle like this:
$ codesign -d &ndash;entitlements :- &ldquo;Payload/YourApp.app&rdquo;
where YourApp.app is the actual name of your .app bundle.<br/>
Use the security tool to check the entitlements of the app&rsquo;s embedded provisioning profile:
// should add cms, Apple may be a typo
$ security cms -D -i &ldquo;Payload/YourApp.app/embedded.mobileprovision&rdquo;</p>

<p>where YourApp.app is the actual name of your .app bundle.</p>

<!-- more -->


<h3>2.问题描述：</h3>

<pre><code>`&lt;PBXGroup path=`Vendors` UUID=`4931326E1B4A0EBF00741B49`&gt;` attempted to initialize an object with an unknown UUID. `4920B77E1B58900100C9789C` for attribute: `children`. This can be the result of a merge and  the unknown UUID is being discarded.
</code></pre>

<p>解决办法：
1. I opened the .pbxproj file in a text editor.<br/>
a. Go to your .xcodeproj<br/>
b. Right click -> Show package contents<br/>
c. Open .pbxproj with a text editor.<br/>
2. I searched for the UUID.<br/>
3. Turns out that is a static library folder already removed from reference.<br/>
4. I readd folder that contain the static library.<br/>
5. Rerun pod installation.<br/>
6. Issue not happening anymore! :D</p>

<p>Reference:<a href="https://github.com/CocoaPods/CocoaPods/issues/1822">https://github.com/CocoaPods/CocoaPods/issues/1822</a></p>

<h3>3.How do I return to an older version of our code in Subversion?</h3>

<p>解决办法:</p>

<pre><code>svn update
svn merge -r 150:140 .
svn commit -m "Rolled back to r140"
</code></pre>

<p>Reference:<a href="http://stackoverflow.com/questions/814433/how-do-i-return-to-an-older-version-of-our-code-in-subversion">http://stackoverflow.com/questions/814433/how-do-i-return-to-an-older-version-of-our-code-in-subversion</a></p>

<h3>4. Add top layout guide in NIB file</h3>

<p>解决办法：</p>

<pre><code>-(void)viewDidLoad {
      if ([self respondsToSelector:@selector(edgesForExtendedLayout)])
         self.edgesForExtendedLayout = UIRectEdgeNone;
}
</code></pre>

<p>Reference:<a href="http://stackoverflow.com/questions/17074365/status-bar-and-navigation-bar-appear-over-my-views-bounds-in-ios-7">http://stackoverflow.com/questions/17074365/status-bar-and-navigation-bar-appear-over-my-views-bounds-in-ios-7</a></p>

<h3>5. How do I set the height of tableHeaderView (UITableView) with autolayout?</h3>

<p>Reference:<a href="http://stackoverflow.com/questions/20982558/how-do-i-set-the-height-of-tableheaderview-uitableview-with-autolayout">http://stackoverflow.com/questions/20982558/how-do-i-set-the-height-of-tableheaderview-uitableview-with-autolayout</a></p>

<h3>6. How to resize superview to fit all subviews with autolayout?</h3>

<p>Reference:<a href="http://stackoverflow.com/questions/18118021/how-to-resize-superview-to-fit-all-subviews-with-autolayout/18155803#18155803">http://stackoverflow.com/questions/18118021/how-to-resize-superview-to-fit-all-subviews-with-autolayout/18155803#18155803</a></p>

<h3>7.How to use c++ and objective-c together in XCode 4.2</h3>

<pre><code>1. Rename any .m file to .mm file;
2. If you look at the "Build Settings" there is a place written "Compile Sources As". There is a dropdown menu there where you can select Objective-C++. In the clang/gcc commandline I think it is "-x objective-c++".
</code></pre>

<p>Reference:<a href="http://stackoverflow.com/questions/9250655/how-to-use-c-and-objective-c-together-in-xcode-4-2">http://stackoverflow.com/questions/9250655/how-to-use-c-and-objective-c-together-in-xcode-4-2</a></p>

<h3>8.How do I change the status bar content to white?</h3>

<p>Here are the steps involved in changing the contents of the status bar (battery, time, signal) to white:</p>

<p>Starting with iOS 8, you need to set the status bar color in the Project Editor, otherwise the status bar flashes from black to white when your app first starts:
Select the very first node in the Project Navigator to display the Project Editor.
Select your app under Targets.
Select the General tab and under the Deployment Info section, set Status Bar Style to Light.</p>

<p>Next, you need to modify your project&rsquo;s .plist file.
In the Project Navigator, expand the Supporting Files node.
Select the <My Project Name>-Info.plist file.
Click on the very first entry (Information Property List).
Click the plus (+) sign that appears in the first column.
At the bottom of the popup list, select View controller-based status bar appearance.
Make sure the Value column is set to NO.
If you want to change the status bar content color for all scenes in your app, add the following code to the AppDelegate class&rsquo;s application:didFinishLaunchingWithOptions method (add it before the return YES statement), or you can add it to an individual view controller&rsquo;s viewDidLoad method:
In Swift:</p>

<pre><code>UIApplication.sharedApplication().statusBarStyle = UIStatusBarStyle.LightContent
</code></pre>

<p>In Objective-C:</p>

<pre><code>[[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleLightContent];
</code></pre>

<p>If you are hiding the status bar in some scenes in your app, and you have a root navigation controller, you may need to add the following code to the root navigation controller:</p>

<p>In Swift:</p>

<pre><code>override func preferredStatusBarStyle() -&gt; UIStatusBarStyle {
        return UIStatusBarStyle.LightContent
}
</code></pre>

<p>In Objective-C:</p>

<pre><code>- (UIStatusBarStyle)preferredStatusBarStyle
{
    return UIStatusBarStyleLightContent;
}
</code></pre>

<p>Reference:<a href="http://iosappsfornonprogrammers.com/forum/index.php?topic=1554.0">http://iosappsfornonprogrammers.com/forum/index.php?topic=1554.0</a></p>

<h3>9.Expression</h3>

<pre><code>(lldb) expr NSString *$str = (NSString *)[[NSString alloc] initWithData:data encoding:4]
(lldb) po $str

(lldb) e NSArray *$array = @[ @"Saturday", @"Sunday", @"Monday" ]
(lldb) p [$array count]
</code></pre>

<h3>10.fastlane add Slack Notifications</h3>

<p>Create an Incoming WebHook and export this as SLACK_URL. Can send a message to #channel (by default), a direct message to @username or a message to a private group group with success (green) or failure (red) status.</p>

<p>Slack > Menu > API > Incoming Webhooks > Set up an incoming webhook integration in your Slack team to try it out.</p>

<p>Reference:<a href="https://github.com/KrauseFx/fastlane/blob/master/docs/Actions.md#notifications">https://github.com/KrauseFx/fastlane/blob/master/docs/Actions.md#notifications</a></p>

<h3>11.问题描述：</h3>

<pre><code>directory not found for option '-F/Applications/Xcode-beta.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS9.0.sdk/Developer/Library/Frameworks' "
</code></pre>

<p>Solution:Further to a migration of my Xcode project, from Xcode 6.4 to Xcode 7, I get the warning message below (after compilation) for the Test target :</p>

<p>directory not found for option &lsquo;-F/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator9.0.sdk/Developer/Library/Frameworks&rsquo;
Actually I found something when comparing a new project vs an older one&hellip;</p>

<p>In the old project, the warning was only being produced by the test target of my projects. Under &lsquo;Search Paths&rsquo;, I found it was including two items under &lsquo;Framework Search Paths&rsquo;:</p>

<p>$(SDKROOT)/Developer/Library/Frameworks
$(inherited)
The new project kept the &lsquo;Framework Search Paths&rsquo; empty.</p>

<p>Deleting those entries in my older project then removed the warning.</p>

<p>Reference:<a href="http://stackoverflow.com/questions/30827022/xcode-7-beta-library-search-path-warning">http://stackoverflow.com/questions/30827022/xcode-7-beta-library-search-path-warning</a></p>

<h3>12.问题描述：</h3>

<pre><code>ld: '/Users/dongmeiliang/Documents/ZHYJApp/ZHYJApp/ZHYJApp/Vendors/baiduMap/Release-iphoneos/BaiduMapAPI.framework/BaiduMapAPI(BMAddrList.o)' does not contain bitcode. You must rebuild it with bitcode enabled (Xcode setting ENABLE_BITCODE), obtain an updated library from the vendor, or disable bitcode for this target. for architecture arm64
</code></pre>

<p>Solution:disable bitcode for this target.
App target > Build Settings > Enable Bitcode > NO</p>

<p>Reference:<a href="http://stackoverflow.com/questions/30848208/new-warnings-in-ios9">http://stackoverflow.com/questions/30848208/new-warnings-in-ios9</a></p>

<h3>13.问题描述：</h3>

<pre><code>*** Assertion failure in +[AAPLListUtilities sharedApplicationGroupContainer], /Users/dongmeiliang/Downloads/ListerforwatchOSiOSandOSX/Objective-C/ListerKit/AAPLListUtilities.m:33
2015-09-22 15:31:20.966 Lister[84089:1396115] *** Terminating app due to uncaught exception 'NSInternalInconsistencyException', reason: 'The shared application group container is unavailable. Check your entitlements and provisioning profiles for this target. Details on proper setup can be found in the PDFs referenced from the README.'
</code></pre>

<p>Solution:Target > Lister > iCloud > Fix issue
            Target > App Group > Fix issue</p>

<p>Reference:<a href="http://stackoverflow.com/questions/27008730/new-lister-app-error-the-shared-application-group-container-is-unavailable-che">http://stackoverflow.com/questions/27008730/new-lister-app-error-the-shared-application-group-container-is-unavailable-che</a></p>

<h3>14.How can I conditionally include a file based on build configuration in Xcode?</h3>

<p>For each target for which you want to conditionally include the settings bundle, choose its Project from the source list, choose the target, and switch to the &ldquo;Build Phases&rdquo; tab.</p>

<p>Click the &ldquo;Add Build Phase&rdquo; button and choose &ldquo;Add Run Script&rdquo;.</p>

<p>Then enter the following for the script:</p>

<pre><code>if [ "${CONFIGURATION}" == "Debug" ]; then
    cp -r "${PROJECT_DIR}/Settings.bundle" "${BUILT_PRODUCTS_DIR}/${PRODUCT_NAME}.app"
fi
</code></pre>

<p>Reference:<a href="http://stackoverflow.com/questions/8496476/how-can-i-conditionally-include-a-file-based-on-build-configuration-in-xcode">http://stackoverflow.com/questions/8496476/how-can-i-conditionally-include-a-file-based-on-build-configuration-in-xcode</a></p>

<h3>15.Automatic Preferred Max Layout Width is not available on iOS versions prior to 8.0</h3>

<p>Solution: 1. Go to Issue Navigator (CMD+8) and Select latest built with the warning <br/>
2. Locate the warning(s) (search for &ldquo;Automatic Preferred Max Layout&rdquo;) and press expand button on the right<br/>
3. Find the Object ID of the UILabel<br/>
4. Open the Storyboard and SEARCH (CMD+f) for the object. It will SELECT AND HIGHLIGHT the UILabel<br/>
5. Explictit set preferred layout width</p>

<p>Reference:<a href="http://stackoverflow.com/questions/25398312/automatic-preferred-max-layout-width-is-not-available-on-ios-versions-prior-to-8">http://stackoverflow.com/questions/25398312/automatic-preferred-max-layout-width-is-not-available-on-ios-versions-prior-to-8</a></p>
]]></content>
  </entry>
  
</feed>
